{"version":3,"file":"auth.js","sources":["utils/auth.js"],"sourcesContent":["import api from \"./api\";\n/**\n * 用户认证工具类\n */\nclass Auth {\n  /**\n   * 检查用户是否已登录\n   */\n  static isLoggedIn() {\n    return uni.getStorageSync(\"isLoggedIn\") === true;\n  }\n\n  /**\n   * 获取用户信息\n   */\n  static getUserInfo() {\n    return uni.getStorageSync(\"userInfo\") || null;\n  }\n\n  /**\n   * 保存用户信息\n   */\n  static setUserInfo(userInfo) {\n    uni.setStorageSync(\"userInfo\", userInfo);\n    uni.setStorageSync(\"isLoggedIn\", true);\n  }\n\n  /**\n   * 清除用户信息\n   */\n  static clearUserInfo() {\n    uni.removeStorageSync(\"userInfo\");\n    uni.removeStorageSync(\"isLoggedIn\");\n    uni.removeStorageSync(\"token\");\n    uni.removeStorageSync(\"openid\");\n  }\n\n  /**\n   * 获取token\n   */\n  static getToken() {\n    return uni.getStorageSync(\"token\") || null;\n  }\n\n  /**\n   * 保存token\n   */\n  static setToken(token) {\n    uni.setStorageSync(\"token\", token);\n  }\n\n  /**\n   * 清除token\n   */\n  static clearToken() {\n    uni.removeStorageSync(\"token\");\n  }\n\n  /**\n   * 获取openid\n   */\n  static getOpenid() {\n    return uni.getStorageSync(\"openid\") || null;\n  }\n\n  /**\n   * 保存openid\n   */\n  static setOpenid(openid) {\n    uni.setStorageSync(\"openid\", openid);\n  }\n\n  /**\n   * 清除openid\n   */\n  static clearOpenid() {\n    uni.removeStorageSync(\"openid\");\n  }\n\n  /**\n   * 获取用户昵称\n   */\n  static getNickname() {\n    const userInfo = this.getUserInfo();\n    return userInfo ? userInfo.nickname : \"\";\n  }\n\n  /**\n   * 检查是否需要设置昵称\n   */\n  static needSetNickname() {\n    const userInfo = this.getUserInfo();\n    return !userInfo || !userInfo.nickname || userInfo.nickname === \"微信用户\";\n  }\n\n  /**\n   * 微信授权登录\n   */\n  static async wechatLogin(phoneCode) {\n    return new Promise((resolve, reject) => {\n      uni.login({\n        provider: \"weixin\",\n        success: (res) => {\n          console.log(\"微信授权成功:\", res);\n          const loginCode = res.code;\n          const data = {\n            phoneCode: phoneCode,\n            loginCode: loginCode,\n            state: \"9b2ffbc1-7425-4155-9894-9d5c08541d62\",\n          };\n          api.wechat.wechatLogin(data).then((res) => {\n            console.log(\"微信登录结果:\", res);\n            if (res.code == 0) {\n              const token = res.data.accessToken;\n              const openid = res.data.openid;\n              // 保存token到本地存储\n              this.setToken(token);\n              this.setOpenid(openid);\n              api.user.getProfile().then((res) => {\n                if (res.code == 0) {\n                  this.setUserInfo(res.data);\n                  resolve(res.data);\n                }\n              });\n            } else {\n              reject(res);\n            }\n          });\n        },\n        fail: (err) => {\n          console.error(\"微信授权失败:\", err);\n          reject(err);\n        },\n      });\n      // uni.getUserProfile({\n      //   desc: \"用于完善用户资料\",\n      //   success: (res) => {\n      //     console.log(\"获取用户信息成功:\", res.userInfo);\n      //     resolve(res.userInfo);\n      //   },\n      //   fail: (err) => {\n      //     console.error(\"获取用户信息失败:\", err);\n      //     reject(err);\n      //   },\n      // });\n    });\n  }\n\n  /**\n   * 退出登录\n   */\n  static logout() {\n    this.clearUserInfo();\n    uni.showToast({\n      title: \"已退出登录\",\n      icon: \"success\",\n    });\n\n    // 跳转到登录页\n    setTimeout(() => {\n      uni.reLaunch({\n        url: \"/pages/index/index\",\n      });\n    }, 1500);\n  }\n}\n\nexport default Auth;\n"],"names":["Auth","uni","userInfo","token","openid","phoneCode","resolve","reject","res","loginCode","data","api","err"],"mappings":"0EAIA,MAAMA,CAAK,CAIT,OAAO,YAAa,CAClB,OAAOC,QAAI,eAAe,YAAY,IAAM,EAC7C,CAKD,OAAO,aAAc,CACnB,OAAOA,QAAI,eAAe,UAAU,GAAK,IAC1C,CAKD,OAAO,YAAYC,EAAU,CAC3BD,EAAAA,MAAI,eAAe,WAAYC,CAAQ,EACvCD,EAAAA,MAAI,eAAe,aAAc,EAAI,CACtC,CAKD,OAAO,eAAgB,CACrBA,QAAI,kBAAkB,UAAU,EAChCA,QAAI,kBAAkB,YAAY,EAClCA,QAAI,kBAAkB,OAAO,EAC7BA,QAAI,kBAAkB,QAAQ,CAC/B,CAKD,OAAO,UAAW,CAChB,OAAOA,QAAI,eAAe,OAAO,GAAK,IACvC,CAKD,OAAO,SAASE,EAAO,CACrBF,EAAAA,MAAI,eAAe,QAASE,CAAK,CAClC,CAKD,OAAO,YAAa,CAClBF,QAAI,kBAAkB,OAAO,CAC9B,CAKD,OAAO,WAAY,CACjB,OAAOA,QAAI,eAAe,QAAQ,GAAK,IACxC,CAKD,OAAO,UAAUG,EAAQ,CACvBH,EAAAA,MAAI,eAAe,SAAUG,CAAM,CACpC,CAKD,OAAO,aAAc,CACnBH,QAAI,kBAAkB,QAAQ,CAC/B,CAKD,OAAO,aAAc,CACnB,MAAMC,EAAW,KAAK,cACtB,OAAOA,EAAWA,EAAS,SAAW,EACvC,CAKD,OAAO,iBAAkB,CACvB,MAAMA,EAAW,KAAK,cACtB,MAAO,CAACA,GAAY,CAACA,EAAS,UAAYA,EAAS,WAAa,MACjE,CAKD,aAAa,YAAYG,EAAW,CAClC,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtCN,EAAAA,MAAI,MAAM,CACR,SAAU,SACV,QAAUO,GAAQ,CAChBP,EAAA,MAAA,MAAA,MAAA,uBAAY,UAAWO,CAAG,EAC1B,MAAMC,EAAYD,EAAI,KAChBE,EAAO,CACX,UAAWL,EACX,UAAWI,EACX,MAAO,sCACnB,EACUE,EAAG,IAAC,OAAO,YAAYD,CAAI,EAAE,KAAMF,GAAQ,CAEzC,GADAP,EAAY,MAAA,MAAA,MAAA,uBAAA,UAAWO,CAAG,EACtBA,EAAI,MAAQ,EAAG,CACjB,MAAML,EAAQK,EAAI,KAAK,YACjBJ,EAASI,EAAI,KAAK,OAExB,KAAK,SAASL,CAAK,EACnB,KAAK,UAAUC,CAAM,EACrBO,EAAAA,IAAI,KAAK,WAAY,EAAC,KAAMH,GAAQ,CAC9BA,EAAI,MAAQ,IACd,KAAK,YAAYA,EAAI,IAAI,EACzBF,EAAQE,EAAI,IAAI,EAElC,CAAe,CACf,MACcD,EAAOC,CAAG,CAExB,CAAW,CACF,EACD,KAAOI,GAAQ,CACbX,EAAA,MAAA,MAAA,QAAA,uBAAc,UAAWW,CAAG,EAC5BL,EAAOK,CAAG,CACX,CACT,CAAO,CAYP,CAAK,CACF,CAKD,OAAO,QAAS,CACd,KAAK,cAAa,EAClBX,EAAAA,MAAI,UAAU,CACZ,MAAO,QACP,KAAM,SACZ,CAAK,EAGD,WAAW,IAAM,CACfA,EAAAA,MAAI,SAAS,CACX,IAAK,oBACb,CAAO,CACF,EAAE,IAAI,CACR,CACH"}