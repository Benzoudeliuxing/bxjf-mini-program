{"version":3,"file":"form.js","sources":["pages/form/form.vue","pages/form/form.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"form-container\">\n    <view class=\"form-content\">\n      <!-- 投保人信息 -->\n      <view class=\"section\">\n        <view class=\"section-title\">\n          <text class=\"section-text\">投保人信息</text>\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">姓名 <text class=\"required\">*</text></text>\n          <input\n            class=\"input\"\n            v-model=\"formData.tbName\"\n            placeholder=\"请输入投保人姓名\"\n            maxlength=\"20\"\n          />\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">身份证号 <text class=\"required\">*</text></text>\n          <input\n            class=\"input\"\n            v-model=\"formData.tbIdCard\"\n            placeholder=\"请输入身份证号码\"\n            maxlength=\"18\"\n            type=\"idcard\"\n          />\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">联系电话 <text class=\"required\">*</text></text>\n          <input\n            class=\"input\"\n            v-model=\"formData.tbPhone\"\n            placeholder=\"请输入手机号码\"\n            maxlength=\"11\"\n            type=\"number\"\n          />\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">住址 <text class=\"required\">*</text></text>\n          <textarea\n            class=\"textarea\"\n            v-model=\"formData.tbAddress\"\n            placeholder=\"请输入详细住址\"\n            maxlength=\"100\"\n          />\n        </view>\n      </view>\n\n      <!-- 被保险人信息 -->\n      <view class=\"section\">\n        <view class=\"section-title\">\n          <text class=\"section-text\">被保险人信息</text>\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">姓名 <text class=\"required\">*</text></text>\n          <input\n            class=\"input\"\n            v-model=\"formData.bbName\"\n            placeholder=\"请输入被保险人姓名\"\n            maxlength=\"20\"\n          />\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">身份证号 <text class=\"required\">*</text></text>\n          <input\n            class=\"input\"\n            v-model=\"formData.bbIdCard\"\n            placeholder=\"请输入身份证号码\"\n            maxlength=\"18\"\n            type=\"idcard\"\n          />\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">联系电话 <text class=\"required\">*</text></text>\n          <input\n            class=\"input\"\n            v-model=\"formData.bbPhone\"\n            placeholder=\"请输入手机号码\"\n            maxlength=\"11\"\n            type=\"number\"\n          />\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">住址 <text class=\"required\">*</text></text>\n          <textarea\n            class=\"textarea\"\n            v-model=\"formData.bbAddress\"\n            placeholder=\"请输入详细住址\"\n            maxlength=\"100\"\n          />\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">学校 <text class=\"required\">*</text></text>\n          <input\n            class=\"input\"\n            v-model=\"formData.bbSchool\"\n            placeholder=\"请输入学校名称\"\n            maxlength=\"50\"\n          />\n        </view>\n\n        <view class=\"form-item\">\n          <text class=\"label\">班级 <text class=\"required\">*</text></text>\n          <input\n            class=\"input\"\n            v-model=\"formData.bbClass\"\n            placeholder=\"请输入班级\"\n            maxlength=\"20\"\n          />\n        </view>\n      </view>\n\n      <!-- 快速填写按钮 -->\n      <view class=\"quick-fill-section\" v-if=\"false\">\n        <button class=\"quick-fill-btn\" @click=\"quickFill\">\n          快速填写测试数据\n        </button>\n      </view>\n\n      <!-- 提交按钮 -->\n      <view class=\"submit-section\">\n        <button class=\"submit-btn\" @click=\"submitForm\" :disabled=\"isSubmitting\">\n          {{ isSubmitting ? \"提交中...\" : \"提交信息\" }}\n        </button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport request from \"../../utils/request.js\";\nimport Auth from \"../../utils/auth.js\";\n\nexport default {\n  name: \"Form\",\n  data() {\n    return {\n      isSubmitting: false,\n      formData: {\n        tbName: \"\",\n        tbIdCard: \"\",\n        tbPhone: \"\",\n        tbAddress: \"\",\n        bbName: \"\",\n        bbIdCard: \"\",\n        bbPhone: \"\",\n        bbAddress: \"\",\n        bbSchool: \"\",\n        bbClass: \"\",\n        payPrice: \"100\",\n        openid: \"\",\n      },\n    };\n  },\n  onLoad() {\n    // 从缓存中获取openid\n    const openid = Auth.getOpenid();\n    if (openid) {\n      this.formData.openid = openid;\n    }\n  },\n  methods: {\n    // 验证身份证号\n    validateIdCard(idCard) {\n      const reg = /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/;\n      return reg.test(idCard);\n    },\n\n    // 验证手机号\n    validatePhone(phone) {\n      const reg = /^1[3-9]\\d{9}$/;\n      return reg.test(phone);\n    },\n\n    // 验证必填项\n    validateRequired(value, fieldName) {\n      if (!value || value.trim() === \"\") {\n        uni.showToast({\n          title: `请填写${fieldName}`,\n          icon: \"none\",\n        });\n        return false;\n      }\n      return true;\n    },\n\n    // 提交表单\n    async submitForm() {\n      if (this.isSubmitting) return;\n\n      // 验证投保人信息\n      if (!this.validateRequired(this.formData.tbName, \"投保人姓名\")) return;\n      if (!this.validateRequired(this.formData.tbIdCard, \"投保人身份证号\"))\n        return;\n      if (!this.validateIdCard(this.formData.tbIdCard)) {\n        uni.showToast({\n          title: \"投保人身份证号格式不正确\",\n          icon: \"none\",\n        });\n        return;\n      }\n      if (!this.validateRequired(this.formData.tbPhone, \"投保人联系电话\"))\n        return;\n      if (!this.validatePhone(this.formData.tbPhone)) {\n        uni.showToast({\n          title: \"投保人手机号格式不正确\",\n          icon: \"none\",\n        });\n        return;\n      }\n      if (!this.validateRequired(this.formData.tbAddress, \"投保人住址\")) return;\n\n      // 验证被保险人信息\n      if (!this.validateRequired(this.formData.bbName, \"被保险人姓名\")) return;\n      if (!this.validateRequired(this.formData.bbIdCard, \"被保险人身份证号\"))\n        return;\n      if (!this.validateIdCard(this.formData.bbIdCard)) {\n        uni.showToast({\n          title: \"被保险人身份证号格式不正确\",\n          icon: \"none\",\n        });\n        return;\n      }\n      if (!this.validateRequired(this.formData.bbPhone, \"被保险人联系电话\"))\n        return;\n      if (!this.validatePhone(this.formData.bbPhone)) {\n        uni.showToast({\n          title: \"被保险人手机号格式不正确\",\n          icon: \"none\",\n        });\n        return;\n      }\n      if (!this.validateRequired(this.formData.bbAddress, \"被保险人住址\"))\n        return;\n      if (!this.validateRequired(this.formData.bbSchool, \"学校\")) return;\n      if (!this.validateRequired(this.formData.bbClass, \"班级\")) return;\n\n      // 所有验证通过，提交数据\n      await this.submitToServer();\n    },\n\n    // 快速填写测试数据\n    quickFill() {\n      // 保留当前的openid值\n      const currentOpenid = this.formData.openid;\n\n      this.formData = {\n        tbName: \"张三\",\n        tbIdCard: \"110101199001011234\",\n        tbPhone: \"13800138000\",\n        tbAddress: \"北京市朝阳区朝阳路123号\",\n        bbName: \"李四\",\n        bbIdCard: \"110101200501012345\",\n        bbPhone: \"13900139000\",\n        bbAddress: \"北京市朝阳区朝阳路456号\",\n        bbSchool: \"北京市第一中学\",\n        bbClass: \"高三(1)班\",\n        payPrice: \"0.01\",\n        openid: currentOpenid, // 保持openid不变\n      };\n\n      uni.showToast({\n        title: \"测试数据填写完成\",\n        icon: \"success\",\n        duration: 1500,\n      });\n    },\n\n    // 提交到服务器\n    async submitToServer() {\n      this.isSubmitting = true;\n\n      try {\n        // 显示加载提示\n        uni.showLoading({\n          title: \"提交中...\",\n          mask: true,\n        });\n\n        const response = await request.post(\n          \"/app-api/bxgm/order/create\",\n          this.formData\n        );\n\n        console.log(\"提交成功:\", response);\n\n        uni.hideLoading();\n\n        uni.showToast({\n          title: \"信息提交成功\",\n          icon: \"success\",\n          duration: 1500,\n        });\n\n        // 延迟跳转到支付页面，让用户看到成功提示\n        setTimeout(() => {\n          // 构建支付页面参数\n          const paymentParams = {\n            id: response.data,\n          };\n\n          // 跳转到支付页面\n          const queryString = Object.keys(paymentParams)\n            .map((key) => `${key}=${encodeURIComponent(paymentParams[key])}`)\n            .join(\"&\");\n          uni.redirectTo({\n            url: `/pages/payment/payment?${queryString}`,\n          });\n        }, 1500);\n      } catch (error) {\n        console.error(\"提交失败:\", error);\n\n        uni.hideLoading();\n\n        // 根据错误类型显示不同的提示\n        let errorMessage = \"提交失败，请重试\";\n        if (error.message) {\n          errorMessage = error.message;\n        } else if (error.errMsg) {\n          errorMessage = error.errMsg;\n        }\n\n        uni.showToast({\n          title: errorMessage,\n          icon: \"none\",\n          duration: 3000,\n        });\n      } finally {\n        this.isSubmitting = false;\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.form-container {\n  padding: 20rpx;\n  background-color: #f5f5f5;\n  min-height: 100vh;\n}\n\n.header {\n  text-align: center;\n  padding: 40rpx 0;\n  background-color: #fff;\n  border-radius: 20rpx;\n  margin-bottom: 20rpx;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.form-content {\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 30rpx;\n}\n\n.section {\n  margin-bottom: 40rpx;\n}\n\n.section-title {\n  border-bottom: 2rpx solid #e0e0e0;\n  padding-bottom: 20rpx;\n  margin-bottom: 30rpx;\n}\n\n.section-text {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.form-item {\n  margin-bottom: 30rpx;\n}\n\n.label {\n  display: block;\n  font-size: 28rpx;\n  color: #333;\n  margin-bottom: 15rpx;\n  font-weight: 500;\n}\n\n.required {\n  color: #ff4757;\n}\n\n.input {\n  width: 100%;\n  height: 80rpx;\n  border: 2rpx solid #e0e0e0;\n  border-radius: 10rpx;\n  padding: 0 20rpx;\n  font-size: 28rpx;\n  background-color: #fff;\n  box-sizing: border-box;\n}\n\n.textarea {\n  width: 100%;\n  height: 120rpx;\n  border: 2rpx solid #e0e0e0;\n  border-radius: 10rpx;\n  padding: 20rpx;\n  font-size: 28rpx;\n  background-color: #fff;\n  box-sizing: border-box;\n  resize: none;\n}\n\n.input:focus,\n.textarea:focus {\n  border-color: #007aff;\n  outline: none;\n}\n\n.submit-section {\n  margin-top: 60rpx;\n  padding: 0 20rpx;\n}\n\n.submit-btn {\n  width: 100%;\n  height: 88rpx;\n  background: linear-gradient(135deg, #007aff, #0056cc);\n  color: #fff;\n  border: none;\n  border-radius: 44rpx;\n  font-size: 32rpx;\n  font-weight: bold;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.submit-btn:active {\n  transform: scale(0.98);\n  opacity: 0.9;\n}\n\n.submit-btn[disabled] {\n  background: #cccccc !important;\n  color: #999999 !important;\n  cursor: not-allowed;\n}\n\n.submit-btn[disabled]:active {\n  transform: none;\n  opacity: 1;\n}\n\n.quick-fill-section {\n  margin-top: 40rpx;\n  margin-bottom: 20rpx;\n  padding: 0 20rpx;\n}\n\n.quick-fill-btn {\n  width: 100%;\n  height: 76rpx;\n  background: linear-gradient(135deg, #ff6b6b, #ee5a52);\n  color: #fff;\n  border: none;\n  border-radius: 38rpx;\n  font-size: 28rpx;\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.quick-fill-btn:active {\n  transform: scale(0.98);\n  opacity: 0.9;\n}\n</style>\n","import MiniProgramPage from '/Users/will/Documents/WillProject/Uni-App/bxjf-mini-program/pages/form/form.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","openid","Auth","idCard","phone","value","fieldName","uni","currentOpenid","response","request","paymentParams","queryString","key","error","errorMessage","MiniProgramPage"],"mappings":"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"}