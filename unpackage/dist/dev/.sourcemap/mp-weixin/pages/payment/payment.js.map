{"version":3,"file":"payment.js","sources":["pages/payment/payment.vue","pages/payment/payment.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"payment-container\">\n    <!-- 头部 -->\n    <view class=\"header\">\n      <text class=\"title\">订单支付</text>\n    </view>\n\n    <!-- 订单信息 -->\n    <view class=\"order-info\">\n      <view class=\"order-item\">\n        <text class=\"label\">订单号：</text>\n        <text class=\"value\">{{ orderInfo.orderNo }}</text>\n      </view>\n      <view class=\"order-item\">\n        <text class=\"label\">商品名称：</text>\n        <text class=\"value\">{{ orderInfo.productName }}</text>\n      </view>\n      <view class=\"order-item\">\n        <text class=\"label\">订单金额：</text>\n        <text class=\"value price\"\n          >¥{{ (orderInfo.amount / 100).toFixed(2) }}</text\n        >\n      </view>\n      <view class=\"order-item\">\n        <text class=\"label\">支付金额：</text>\n        <text class=\"value price\"\n          >¥{{ (orderInfo.payAmount / 100).toFixed(2) }}</text\n        >\n      </view>\n    </view>\n\n    <!-- 支付方式 -->\n    <view class=\"payment-method\">\n      <view class=\"method-title\">选择支付方式</view>\n      <view class=\"method-item\" @click=\"selectPaymentMethod('wechat')\">\n        <view class=\"method-info\">\n          <image\n            class=\"method-icon\"\n            src=\"/static/wechat-pay.png\"\n            mode=\"aspectFit\"\n          ></image>\n          <text class=\"method-name\">微信支付</text>\n        </view>\n        <view class=\"method-check\">\n          <view\n            class=\"check-icon\"\n            :class=\"{ active: selectedMethod === 'wechat' }\"\n          ></view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 支付按钮 -->\n    <view class=\"payment-action\">\n      <button class=\"pay-btn\" @click=\"handlePayment\" :disabled=\"isPaying\">\n        {{ isPaying ? \"支付中...\" : \"立即支付\" }}\n      </button>\n    </view>\n\n    <!-- 支付说明 -->\n    <view class=\"payment-tips\">\n      <text class=\"tips-text\">支付说明：</text>\n      <text class=\"tips-content\">1. 请确保微信已安装并已登录</text>\n      <text class=\"tips-content\">2. 支付完成后请勿关闭小程序</text>\n      <text class=\"tips-content\">3. 如有问题请联系客服</text>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { wechatPay, getErrorMessage } from \"@/utils/payment.js\";\n\nexport default {\n  name: \"Payment\",\n  data() {\n    return {\n      orderInfo: {\n        orderId: \"\",\n        orderNo: \"\",\n        productName: \"\",\n        amount: 0,\n        payAmount: 0,\n      },\n      selectedMethod: \"wechat\",\n      isPaying: false,\n    };\n  },\n  onLoad(options) {\n    // 获取订单信息\n    this.getOrderInfo(options);\n  },\n  methods: {\n    // 获取订单信息\n    getOrderInfo(options) {\n      // 从页面参数获取订单信息\n      const orderNo = options.orderNo || \"ORDER\" + Date.now();\n      const amount = parseInt(options.amount) || 9900;\n      const title = options.title || \"商品名称\";\n\n      this.orderInfo = {\n        orderId: options.id || \"ORDER\" + Date.now(),\n        orderNo: orderNo,\n        productName: title,\n        amount: amount,\n        payAmount: amount,\n      };\n    },\n\n    // 选择支付方式\n    selectPaymentMethod(method) {\n      this.selectedMethod = method;\n    },\n\n    // 处理支付\n    async handlePayment() {\n      if (this.isPaying) return;\n\n      this.isPaying = true;\n\n      try {\n        // 调用微信支付\n        const result = await wechatPay(this.orderInfo);\n\n        if (result.success) {\n          this.paymentSuccess();\n        } else {\n          this.paymentFail(result.error);\n        }\n      } catch (error) {\n        this.paymentFail(error);\n      } finally {\n        this.isPaying = false;\n      }\n    },\n\n    // 支付成功\n    paymentSuccess() {\n      uni.showToast({\n        title: \"支付成功\",\n        icon: \"success\",\n      });\n\n      // 跳转到支付成功页面\n      setTimeout(() => {\n        uni.redirectTo({\n          url: `/pages/payment-success/payment-success?orderId=${this.orderInfo.orderId}`,\n        });\n      }, 1500);\n    },\n\n    // 支付失败\n    paymentFail(error) {\n      const message = getErrorMessage(error);\n\n      uni.showToast({\n        title: message,\n        icon: \"none\",\n      });\n    },\n  },\n};\n</script>\n\n<style scoped>\n.payment-container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n  padding: 20rpx;\n}\n\n.header {\n  text-align: center;\n  padding: 40rpx 0;\n  background-color: #fff;\n  border-radius: 20rpx;\n  margin-bottom: 20rpx;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.order-info {\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 40rpx;\n  margin-bottom: 20rpx;\n}\n\n.order-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20rpx 0;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.order-item:last-child {\n  border-bottom: none;\n}\n\n.label {\n  font-size: 28rpx;\n  color: #666;\n}\n\n.value {\n  font-size: 28rpx;\n  color: #333;\n}\n\n.price {\n  color: #ff6b35;\n  font-weight: bold;\n  font-size: 32rpx;\n}\n\n.payment-method {\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 40rpx;\n  margin-bottom: 20rpx;\n}\n\n.method-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 30rpx;\n}\n\n.method-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 30rpx 0;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.method-info {\n  display: flex;\n  align-items: center;\n}\n\n.method-icon {\n  width: 60rpx;\n  height: 60rpx;\n  margin-right: 20rpx;\n}\n\n.method-name {\n  font-size: 30rpx;\n  color: #333;\n}\n\n.method-check {\n  display: flex;\n  align-items: center;\n}\n\n.check-icon {\n  width: 40rpx;\n  height: 40rpx;\n  border: 2rpx solid #ddd;\n  border-radius: 50%;\n  position: relative;\n}\n\n.check-icon.active {\n  border-color: #07c160;\n  background-color: #07c160;\n}\n\n.check-icon.active::after {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  width: 20rpx;\n  height: 20rpx;\n  background-color: #fff;\n  border-radius: 50%;\n}\n\n.payment-action {\n  margin-bottom: 20rpx;\n}\n\n.pay-btn {\n  width: 100%;\n  height: 100rpx;\n  background: linear-gradient(135deg, #07c160, #10ad6a);\n  color: #fff;\n  border: none;\n  border-radius: 50rpx;\n  font-size: 32rpx;\n  font-weight: bold;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.pay-btn:disabled {\n  background: #ccc;\n}\n\n.payment-tips {\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 40rpx;\n}\n\n.tips-text {\n  font-size: 28rpx;\n  color: #333;\n  font-weight: bold;\n  margin-bottom: 20rpx;\n  display: block;\n}\n\n.tips-content {\n  font-size: 26rpx;\n  color: #666;\n  line-height: 1.6;\n  display: block;\n  margin-bottom: 10rpx;\n}\n</style>\n","import MiniProgramPage from '/Users/will/Documents/WillProject/Uni-App/bxjf-mini-program/pages/payment/payment.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","options","orderNo","amount","title","method","result","wechatPay","error","uni","message","getErrorMessage","MiniProgramPage"],"mappings":"+HAwEKA,EAAU,CACb,KAAM,UACN,MAAO,CACL,MAAO,CACL,UAAW,CACT,QAAS,GACT,QAAS,GACT,YAAa,GACb,OAAQ,EACR,UAAW,CACZ,EACD,eAAgB,SAChB,SAAU,GAEb,EACD,OAAOC,EAAS,CAEd,KAAK,aAAaA,CAAO,CAC1B,EACD,QAAS,CAEP,aAAaA,EAAS,CAEpB,MAAMC,EAAUD,EAAQ,SAAW,QAAU,KAAK,MAC5CE,EAAS,SAASF,EAAQ,MAAM,GAAK,KACrCG,EAAQH,EAAQ,OAAS,OAE/B,KAAK,UAAY,CACf,QAASA,EAAQ,IAAM,QAAU,KAAK,IAAK,EAC3C,QAASC,EACT,YAAaE,EACb,OAAQD,EACR,UAAWA,EAEd,EAGD,oBAAoBE,EAAQ,CAC1B,KAAK,eAAiBA,CACvB,EAGD,MAAM,eAAgB,CACpB,GAAI,MAAK,SAET,MAAK,SAAW,GAEhB,GAAI,CAEF,MAAMC,EAAS,MAAMC,EAAAA,UAAU,KAAK,SAAS,EAEzCD,EAAO,QACT,KAAK,eAAc,EAEnB,KAAK,YAAYA,EAAO,KAAK,CAE/B,OAAOE,EAAO,CACd,KAAK,YAAYA,CAAK,CACxB,QAAU,CACR,KAAK,SAAW,EAClB,EACD,EAGD,gBAAiB,CACfC,EAAAA,MAAI,UAAU,CACZ,MAAO,OACP,KAAM,SACR,CAAC,EAGD,WAAW,IAAM,CACfA,EAAAA,MAAI,WAAW,CACb,IAAK,kDAAkD,KAAK,UAAU,OAAO,EAC/E,CAAC,CACF,EAAE,IAAI,CACR,EAGD,YAAYD,EAAO,CACjB,MAAME,EAAUC,kBAAgBH,CAAK,EAErCC,EAAAA,MAAI,UAAU,CACZ,MAAOC,EACP,KAAM,MACR,CAAC,CACF,CACF,CACH,gcC/JA,GAAG,WAAWE,CAAe"}