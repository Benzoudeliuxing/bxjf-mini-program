{"version":3,"file":"payment-record.js","sources":["pages/payment-record/payment-record.vue","pages/payment-record/payment-record.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"payment-record-container\">\n    <!-- 搜索和筛选 -->\n    <view class=\"search-filter\">\n      <view class=\"filter-tabs\">\n        <view\n          class=\"filter-tab\"\n          :class=\"{ active: currentStatus === '' }\"\n          @click=\"filterByStatus('')\"\n        >\n          全部\n        </view>\n        <view\n          class=\"filter-tab\"\n          :class=\"{ active: currentStatus === '1' }\"\n          @click=\"filterByStatus('1')\"\n        >\n          待支付\n        </view>\n        <view\n          class=\"filter-tab\"\n          :class=\"{ active: currentStatus === '2' }\"\n          @click=\"filterByStatus('2')\"\n        >\n          已支付\n        </view>\n      </view>\n    </view>\n\n    <!-- 记录列表 -->\n    <view class=\"record-list\">\n      <view\n        class=\"record-item\"\n        v-for=\"record in filteredRecords\"\n        :key=\"record.id\"\n        @click=\"goToDetail(record)\"\n      >\n        <view class=\"record-header\">\n          <text class=\"record-title\">{{\n            record.title || record.name || \"保险订单\"\n          }}</text>\n          <text class=\"record-status\" :class=\"getStatusClass(record.payStatus)\">\n            {{ getStatusText(record.payStatus) }}\n          </text>\n        </view>\n\n        <view class=\"record-info\">\n          <view class=\"info-row\">\n            <text class=\"label\">缴费金额：</text>\n            <text class=\"amount\">¥{{ record.payPrice }}</text>\n          </view>\n          <view class=\"info-row\">\n            <text class=\"label\">缴费时间：</text>\n            <text class=\"time\">{{ record.payTime || \"-\" }}</text>\n          </view>\n          <view class=\"info-row\">\n            <text class=\"label\">订单号：</text>\n            <text class=\"order-no\">{{ record.orderNo || \"-\" }}</text>\n          </view>\n        </view>\n\n        <view class=\"record-footer\">\n          <text class=\"detail-text\">点击查看详情 ></text>\n        </view>\n      </view>\n\n      <!-- 空状态 -->\n      <view class=\"empty-state\" v-if=\"filteredRecords.length === 0\">\n        <text class=\"empty-icon\">📋</text>\n        <text class=\"empty-text\">暂无缴费记录</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { formatAmount } from \"@/utils/payment.js\";\nimport { businessApi } from \"@/utils/api.js\";\n\nexport default {\n  name: \"PaymentRecord\",\n  data() {\n    return {\n      searchKeyword: \"\",\n      currentStatus: \"\", // 空字符串表示全部，1-待支付，2-已支付\n      records: [],\n      loading: false,\n      pageNo: 1,\n      pageSize: 10,\n      hasMore: true,\n    };\n  },\n  computed: {\n    filteredRecords() {\n      let filtered = this.records;\n\n      // 按关键词搜索\n      if (this.searchKeyword) {\n        const keyword = this.searchKeyword.toLowerCase();\n        filtered = filtered.filter(\n          (record) =>\n            (record.title && record.title.toLowerCase().includes(keyword)) ||\n            (record.orderNo &&\n              record.orderNo.toLowerCase().includes(keyword)) ||\n            (record.description &&\n              record.description.toLowerCase().includes(keyword))\n        );\n      }\n\n      return filtered;\n    },\n  },\n  methods: {\n    formatAmount,\n\n    onSearchInput() {\n      // 搜索输入处理，可以添加防抖逻辑\n    },\n\n    async filterByStatus(status) {\n      this.currentStatus = status;\n      this.pageNo = 1;\n      this.records = [];\n      this.hasMore = true;\n      await this.loadPaymentRecords();\n    },\n\n    getStatusText(payStatus) {\n      const statusMap = {\n        1: \"待支付\",\n        2: \"已支付\",\n        3: \"申请退款\",\n        4: \"已退款\",\n      };\n      return statusMap[payStatus] || \"未知状态\";\n    },\n\n    getStatusClass(payStatus) {\n      const classMap = {\n        1: \"unpaid\",\n        2: \"paid\",\n        3: \"refunding\",\n        4: \"refunded\",\n      };\n      return classMap[payStatus] || \"\";\n    },\n\n    formatDate(dateString) {\n      if (!dateString) return \"待缴费\";\n      const date = new Date(dateString);\n      return date.toLocaleString(\"zh-CN\", {\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      });\n    },\n\n    goToDetail(record) {\n      uni.navigateTo({\n        url: `/pages/payment-detail/payment-detail?id=${record.id}&orderNo=${\n          record.orderNo || record.orderNumber\n        }`,\n      });\n    },\n\n    async loadPaymentRecords() {\n      if (this.loading || !this.hasMore) return;\n\n      this.loading = true;\n\n      try {\n        const params = {\n          pageNo: this.pageNo,\n          pageSize: this.pageSize,\n        };\n\n        // 如果有选择支付状态，添加到参数中\n        if (this.currentStatus) {\n          params.payStatus = this.currentStatus;\n        }\n\n        const response = await businessApi.getOrderList(params);\n\n        if (response && response.data) {\n          const newRecords = response.data.list || response.data || [];\n\n          if (this.pageNo === 1) {\n            this.records = newRecords;\n          } else {\n            this.records = [...this.records, ...newRecords];\n          }\n\n          // 判断是否还有更多数据\n          this.hasMore = newRecords.length === this.pageSize;\n\n          if (this.hasMore) {\n            this.pageNo++;\n          }\n        }\n      } catch (error) {\n        console.error(\"获取订单列表失败:\", error);\n        uni.showToast({\n          title: \"获取数据失败\",\n          icon: \"none\",\n        });\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    // 加载更多数据\n    async loadMore() {\n      if (!this.loading && this.hasMore) {\n        await this.loadPaymentRecords();\n      }\n    },\n  },\n\n  async onLoad() {\n    // 页面加载时获取缴费记录\n    await this.loadPaymentRecords();\n  },\n\n  async onShow() {\n    // 页面显示时刷新数据，重置到第一页\n    this.pageNo = 1;\n    this.records = [];\n    this.hasMore = true;\n    await this.loadPaymentRecords();\n  },\n\n  // 页面触底事件\n  onReachBottom() {\n    this.loadMore();\n  },\n};\n</script>\n\n<style scoped>\n.payment-record-container {\n  padding: 20rpx;\n  background-color: #f5f5f5;\n  min-height: 100vh;\n}\n\n.header {\n  text-align: center;\n  padding: 40rpx 0;\n  background-color: #fff;\n  border-radius: 20rpx;\n  margin-bottom: 20rpx;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.search-filter {\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 30rpx;\n  margin-bottom: 20rpx;\n}\n\n.search-box {\n  position: relative;\n  margin-bottom: 30rpx;\n}\n\n.search-input {\n  width: 100%;\n  height: 80rpx;\n  padding: 0 80rpx 0 30rpx;\n  border: 2rpx solid #e0e0e0;\n  border-radius: 40rpx;\n  font-size: 28rpx;\n  background-color: #f8f8f8;\n}\n\n.search-icon {\n  position: absolute;\n  right: 30rpx;\n  top: 50%;\n  transform: translateY(-50%);\n  font-size: 32rpx;\n  color: #999;\n}\n\n.filter-tabs {\n  display: flex;\n  gap: 20rpx;\n}\n\n.filter-tab {\n  flex: 1;\n  height: 60rpx;\n  line-height: 60rpx;\n  text-align: center;\n  background-color: #f0f0f0;\n  border-radius: 30rpx;\n  font-size: 26rpx;\n  color: #666;\n  transition: all 0.3s;\n}\n\n.filter-tab.active {\n  background-color: #2b8dbc;\n  color: #fff;\n}\n\n.record-list {\n  display: flex;\n  flex-direction: column;\n  gap: 20rpx;\n}\n\n.record-item {\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 30rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n  transition: all 0.3s;\n}\n\n.record-item:active {\n  transform: scale(0.98);\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.15);\n}\n\n.record-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20rpx;\n}\n\n.record-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.record-status {\n  padding: 8rpx 20rpx;\n  border-radius: 20rpx;\n  font-size: 24rpx;\n  font-weight: bold;\n}\n\n.record-status.paid {\n  background-color: #e8f5e8;\n  color: #52c41a;\n}\n\n.record-status.unpaid {\n  background-color: #fff7e6;\n  color: #e09801;\n}\n\n.record-status.failed {\n  background-color: #fff2f0;\n  color: #c51d34;\n}\n\n.record-status.refunding {\n  background-color: #fff7e6;\n  color: #e09801;\n}\n\n.record-status.refunded {\n  background-color: #f6ffed;\n  color: #52c41a;\n}\n\n.record-info {\n  margin-bottom: 20rpx;\n}\n\n.info-row {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 10rpx;\n  font-size: 26rpx;\n}\n\n.label {\n  color: #666;\n}\n\n.amount {\n  color: #c51d34;\n  font-weight: bold;\n}\n\n.time {\n  color: #333;\n}\n\n.order-no {\n  color: #999;\n  font-family: monospace;\n}\n\n.record-footer {\n  border-top: 2rpx solid #f0f0f0;\n  padding-top: 20rpx;\n  text-align: center;\n}\n\n.detail-text {\n  color: #2b8dbc;\n  font-size: 26rpx;\n}\n\n.empty-state {\n  text-align: center;\n  padding: 100rpx 0;\n  color: #999;\n}\n\n.empty-icon {\n  font-size: 80rpx;\n  display: block;\n  margin-bottom: 20rpx;\n}\n\n.empty-text {\n  font-size: 28rpx;\n}\n</style>\n","import MiniProgramPage from '/Users/will/Documents/WillProject/Uni-App/bxjf-mini-program/pages/payment-record/payment-record.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","filtered","keyword","record","formatAmount","status","payStatus","dateString","uni","params","response","businessApi","newRecords","error","MiniProgramPage"],"mappings":"2HA+EKA,EAAU,CACb,KAAM,gBACN,MAAO,CACL,MAAO,CACL,cAAe,GACf,cAAe,GACf,QAAS,CAAE,EACX,QAAS,GACT,OAAQ,EACR,SAAU,GACV,QAAS,GAEZ,EACD,SAAU,CACR,iBAAkB,CAChB,IAAIC,EAAW,KAAK,QAGpB,GAAI,KAAK,cAAe,CACtB,MAAMC,EAAU,KAAK,cAAc,YAAW,EAC9CD,EAAWA,EAAS,OACjBE,GACEA,EAAO,OAASA,EAAO,MAAM,YAAa,EAAC,SAASD,CAAO,GAC3DC,EAAO,SACNA,EAAO,QAAQ,YAAa,EAAC,SAASD,CAAO,GAC9CC,EAAO,aACNA,EAAO,YAAY,YAAa,EAAC,SAASD,CAAO,EAEzD,CAEA,OAAOD,CACR,CACF,EACD,QAAS,cACPG,EAAY,aAEZ,eAAgB,CAEf,EAED,MAAM,eAAeC,EAAQ,CAC3B,KAAK,cAAgBA,EACrB,KAAK,OAAS,EACd,KAAK,QAAU,GACf,KAAK,QAAU,GACf,MAAM,KAAK,oBACZ,EAED,cAAcC,EAAW,CAOvB,MANkB,CAChB,EAAG,MACH,EAAG,MACH,EAAG,OACH,EAAG,OAEYA,CAAS,GAAK,MAChC,EAED,eAAeA,EAAW,CAOxB,MANiB,CACf,EAAG,SACH,EAAG,OACH,EAAG,YACH,EAAG,YAEWA,CAAS,GAAK,EAC/B,EAED,WAAWC,EAAY,CACrB,OAAKA,EACQ,IAAI,KAAKA,CAAU,EACpB,eAAe,QAAS,CAClC,KAAM,UACN,MAAO,UACP,IAAK,UACL,KAAM,UACN,OAAQ,SACV,CAAC,EARuB,KASzB,EAED,WAAWJ,EAAQ,CACjBK,EAAAA,MAAI,WAAW,CACb,IAAK,2CAA2CL,EAAO,EAAE,YACvDA,EAAO,SAAWA,EAAO,WAC3B,EACF,CAAC,CACF,EAED,MAAM,oBAAqB,CACzB,GAAI,OAAK,SAAW,CAAC,KAAK,SAE1B,MAAK,QAAU,GAEf,GAAI,CACF,MAAMM,EAAS,CACb,OAAQ,KAAK,OACb,SAAU,KAAK,UAIb,KAAK,gBACPA,EAAO,UAAY,KAAK,eAG1B,MAAMC,EAAW,MAAMC,EAAAA,YAAY,aAAaF,CAAM,EAEtD,GAAIC,GAAYA,EAAS,KAAM,CAC7B,MAAME,EAAaF,EAAS,KAAK,MAAQA,EAAS,MAAQ,GAEtD,KAAK,SAAW,EAClB,KAAK,QAAUE,EAEf,KAAK,QAAU,CAAC,GAAG,KAAK,QAAS,GAAGA,CAAU,EAIhD,KAAK,QAAUA,EAAW,SAAW,KAAK,SAEtC,KAAK,SACP,KAAK,QAET,CACA,OAAOC,EAAO,CACdL,EAAc,MAAA,MAAA,QAAA,iDAAA,YAAaK,CAAK,EAChCL,EAAAA,MAAI,UAAU,CACZ,MAAO,SACP,KAAM,MACR,CAAC,CACH,QAAU,CACR,KAAK,QAAU,EACjB,EACD,EAGD,MAAM,UAAW,CACX,CAAC,KAAK,SAAW,KAAK,SACxB,MAAM,KAAK,oBAEd,CACF,EAED,MAAM,QAAS,CAEb,MAAM,KAAK,oBACZ,EAED,MAAM,QAAS,CAEb,KAAK,OAAS,EACd,KAAK,QAAU,GACf,KAAK,QAAU,GACf,MAAM,KAAK,oBACZ,EAGD,eAAgB,CACd,KAAK,SAAQ,CACd,CACH,ylBC5OA,GAAG,WAAWM,CAAe"}