{"version":3,"file":"login.js","sources":["pages/login/login.vue","pages/login/login.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"login-container\">\n    <view class=\"header\">\n      <image class=\"logo\" src=\"/static/logo.png\" mode=\"aspectFit\"></image>\n      <text class=\"title\">欢迎使用</text>\n      <text class=\"subtitle\">请授权登录以使用完整功能</text>\n    </view>\n\n    <view class=\"content\">\n      <button\n        class=\"login-btn\"\n        open-type=\"getPhoneNumber\"\n        @getphonenumber=\"getPhoneNumber\"\n      >\n        微信授权登录\n      </button>\n\n      <view class=\"tips\">\n        <text class=\"tips-text\">登录后即可使用所有功能</text>\n      </view>\n    </view>\n\n    <!-- 昵称设置弹窗 -->\n    <view v-if=\"showNicknamePopup\" class=\"popup-mask\" @click=\"closePopup\">\n      <view class=\"nickname-popup\" @click.stop>\n        <view class=\"popup-header\">\n          <text class=\"popup-title\">设置昵称</text>\n        </view>\n        <view class=\"popup-content\">\n          <text class=\"popup-desc\"\n            >请设置您的昵称，方便我们为您提供更好的服务</text\n          >\n          <input\n            class=\"nickname-input\"\n            v-model=\"nickname\"\n            placeholder=\"请输入昵称\"\n            maxlength=\"20\"\n            @input=\"onNicknameInput\"\n          />\n          <text class=\"input-tips\">昵称长度1-20个字符</text>\n        </view>\n        <view class=\"popup-footer\">\n          <button\n            class=\"confirm-btn\"\n            type=\"primary\"\n            @click=\"confirmNickname\"\n            :disabled=\"!nickname.trim()\"\n          >\n            确认\n          </button>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport Auth from \"../../utils/auth.js\";\n\nexport default {\n  name: \"Login\",\n  data() {\n    return {\n      isLoading: false,\n      nickname: \"\",\n      userInfo: null,\n      showNicknamePopup: false,\n    };\n  },\n  methods: {\n    // 获取手机号回调\n    getPhoneNumber(e) {\n      console.log(e);\n      const phoneCode = e.detail.code;\n      this.handleWechatLogin(phoneCode);\n    },\n\n    // 微信授权登录\n    async handleWechatLogin(phoneCode) {\n      this.isLoading = true;\n\n      try {\n        // 获取用户信息\n        const userInfo = await Auth.wechatLogin(phoneCode);\n\n        if (userInfo) {\n          this.userInfo = userInfo;\n\n          // 检查是否有昵称\n          if (Auth.needSetNickname()) {\n            // 显示昵称设置弹窗\n            this.showNicknamePopup = true;\n          } else {\n            // 直接登录成功\n            this.loginSuccess(userInfo);\n          }\n        }\n      } catch (error) {\n        console.error(\"登录失败:\", error);\n        uni.showToast({\n          title: \"登录失败，请重试\",\n          icon: \"none\",\n        });\n      } finally {\n        this.isLoading = false;\n      }\n    },\n\n    // 昵称输入处理\n    onNicknameInput(e) {\n      this.nickname = e.detail.value;\n    },\n\n    // 关闭弹窗\n    closePopup() {\n      this.showNicknamePopup = false;\n    },\n\n    // 确认昵称设置\n    async confirmNickname() {\n      if (!this.nickname.trim()) {\n        uni.showToast({\n          title: \"请输入昵称\",\n          icon: \"none\",\n        });\n        return;\n      }\n\n      try {\n        // 更新用户信息\n        const updatedUserInfo = {\n          ...this.userInfo,\n          nickName: this.nickname.trim(),\n        };\n\n        // 保存用户信息\n        Auth.setUserInfo(updatedUserInfo);\n\n        // 关闭弹窗\n        this.showNicknamePopup = false;\n\n        // 登录成功\n        this.loginSuccess(updatedUserInfo);\n\n        uni.showToast({\n          title: \"昵称设置成功\",\n          icon: \"success\",\n        });\n      } catch (error) {\n        console.error(\"设置昵称失败:\", error);\n        uni.showToast({\n          title: \"设置失败，请重试\",\n          icon: \"none\",\n        });\n      }\n    },\n\n    // 登录成功处理\n    loginSuccess(userInfo) {\n      uni.showToast({\n        title: \"登录成功\",\n        icon: \"success\",\n      });\n\n      // 延迟跳转到首页\n      setTimeout(() => {\n        uni.reLaunch({ url: \"/pages/index/index\" });\n      }, 1500);\n    },\n  },\n\n  onLoad() {\n    // 检查是否已登录\n    if (Auth.isLoggedIn()) {\n      uni.reLaunch({\n        url: \"/pages/index/index\",\n      });\n    }\n  },\n};\n</script>\n\n<style scoped>\n.login-container {\n  min-height: 100vh;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 40rpx;\n}\n\n.header {\n  text-align: center;\n  margin-bottom: 100rpx;\n}\n\n.logo {\n  width: 120rpx;\n  height: 120rpx;\n  margin-bottom: 40rpx;\n}\n\n.title {\n  font-size: 48rpx;\n  font-weight: bold;\n  color: #ffffff;\n  display: block;\n  margin-bottom: 20rpx;\n}\n\n.subtitle {\n  font-size: 28rpx;\n  color: rgba(255, 255, 255, 0.8);\n  display: block;\n}\n\n.content {\n  width: 100%;\n  max-width: 600rpx;\n}\n\n.login-btn {\n  width: 100%;\n  height: 88rpx;\n  border-radius: 44rpx;\n  background: #ffffff;\n  border: none;\n  margin-bottom: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.btn-text {\n  color: #333333;\n  font-size: 32rpx;\n  font-weight: 500;\n}\n\n.tips {\n  text-align: center;\n}\n\n.tips-text {\n  font-size: 24rpx;\n  color: rgba(255, 255, 255, 0.7);\n}\n\n/* 弹窗遮罩层 */\n.popup-mask {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999;\n}\n\n/* 昵称设置弹窗样式 */\n.nickname-popup {\n  background: #ffffff;\n  border-radius: 20rpx;\n  width: 600rpx;\n  padding: 40rpx;\n  margin: 40rpx;\n}\n\n.popup-header {\n  text-align: center;\n  margin-bottom: 40rpx;\n}\n\n.popup-title {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333333;\n}\n\n.popup-content {\n  margin-bottom: 40rpx;\n}\n\n.popup-desc {\n  font-size: 28rpx;\n  color: #666666;\n  line-height: 1.5;\n  margin-bottom: 30rpx;\n  display: block;\n}\n\n.nickname-input {\n  width: 100%;\n  height: 80rpx;\n  border: 2rpx solid #e5e5e5;\n  border-radius: 10rpx;\n  padding: 0 20rpx;\n  font-size: 28rpx;\n  margin-bottom: 20rpx;\n  box-sizing: border-box;\n}\n\n.input-tips {\n  font-size: 24rpx;\n  color: #999999;\n  display: block;\n}\n\n.popup-footer {\n  text-align: center;\n}\n\n.confirm-btn {\n  width: 100%;\n  height: 80rpx;\n  border-radius: 40rpx;\n  font-size: 32rpx;\n  font-weight: 500;\n}\n\n.confirm-btn[disabled] {\n  background: #cccccc !important;\n  color: #ffffff !important;\n}\n</style>\n","import MiniProgramPage from '/Users/will/Documents/WillProject/Uni-App/bxjf-mini-program/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","e","uni","phoneCode","userInfo","Auth","error","updatedUserInfo","MiniProgramPage"],"mappings":"4HA2DKA,EAAU,CACb,KAAM,QACN,MAAO,CACL,MAAO,CACL,UAAW,GACX,SAAU,GACV,SAAU,KACV,kBAAmB,GAEtB,EACD,QAAS,CAEP,eAAeC,EAAG,CAChBC,EAAAA,MAAY,MAAA,MAAA,8BAAAD,CAAC,EACb,MAAME,EAAYF,EAAE,OAAO,KAC3B,KAAK,kBAAkBE,CAAS,CACjC,EAGD,MAAM,kBAAkBA,EAAW,CACjC,KAAK,UAAY,GAEjB,GAAI,CAEF,MAAMC,EAAW,MAAMC,EAAAA,KAAK,YAAYF,CAAS,EAE7CC,IACF,KAAK,SAAWA,EAGZC,EAAAA,KAAK,kBAEP,KAAK,kBAAoB,GAGzB,KAAK,aAAaD,CAAQ,EAG9B,OAAOE,EAAO,CACdJ,EAAc,MAAA,MAAA,QAAA,8BAAA,QAASI,CAAK,EAC5BJ,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACR,CAAC,CACH,QAAU,CACR,KAAK,UAAY,EACnB,CACD,EAGD,gBAAgBD,EAAG,CACjB,KAAK,SAAWA,EAAE,OAAO,KAC1B,EAGD,YAAa,CACX,KAAK,kBAAoB,EAC1B,EAGD,MAAM,iBAAkB,CACtB,GAAI,CAAC,KAAK,SAAS,OAAQ,CACzBC,EAAAA,MAAI,UAAU,CACZ,MAAO,QACP,KAAM,MACR,CAAC,EACD,MACF,CAEA,GAAI,CAEF,MAAMK,EAAkB,CACtB,GAAG,KAAK,SACR,SAAU,KAAK,SAAS,KAAM,GAIhCF,OAAK,YAAYE,CAAe,EAGhC,KAAK,kBAAoB,GAGzB,KAAK,aAAaA,CAAe,EAEjCL,EAAAA,MAAI,UAAU,CACZ,MAAO,SACP,KAAM,SACR,CAAC,CACD,OAAOI,EAAO,CACdJ,EAAA,MAAA,MAAA,QAAA,+BAAc,UAAWI,CAAK,EAC9BJ,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACR,CAAC,CACH,CACD,EAGD,aAAaE,EAAU,CACrBF,EAAAA,MAAI,UAAU,CACZ,MAAO,OACP,KAAM,SACR,CAAC,EAGD,WAAW,IAAM,CACfA,EAAAA,MAAI,SAAS,CAAE,IAAK,oBAAsB,CAAA,CAC3C,EAAE,IAAI,CACR,CACF,EAED,QAAS,CAEHG,EAAAA,KAAK,cACPH,EAAAA,MAAI,SAAS,CACX,IAAK,oBACP,CAAC,CAEJ,CACH,ydClLA,GAAG,WAAWM,CAAe"}