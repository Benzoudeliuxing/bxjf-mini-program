{"version":3,"file":"login.js","sources":["pages/login/login.vue","pages/login/login.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"login-container\">\n    <view class=\"header\">\n      <image class=\"logo\" src=\"/static/logo.jpg\" mode=\"aspectFit\"></image>\n      <text class=\"title\">欢迎使用 学平险采集小程序</text>\n      <!-- <text class=\"subtitle\">请授权登录以使用完整功能</text> -->\n    </view>\n\n    <view class=\"content\">\n      <!-- 隐私协议勾选 -->\n      <view class=\"agreement-section\">\n        <view class=\"checkbox-wrapper\" @click=\"toggleAgreement\">\n          <view class=\"checkbox\" :class=\"{ checked: isAgreed }\">\n            <text v-if=\"isAgreed\" class=\"check-icon\">✓</text>\n          </view>\n          <text class=\"agreement-text\">\n            我已阅读并同意\n            <text class=\"agreement-link\" @click.stop=\"goToPrivacy\"\n              >《隐私协议》</text\n            >\n          </text>\n        </view>\n      </view>\n\n      <button\n        class=\"login-btn\"\n        :class=\"{ disabled: !isAgreed }\"\n        open-type=\"getPhoneNumber\"\n        @getphonenumber=\"getPhoneNumber\"\n        :disabled=\"!isAgreed\"\n      >\n        微信授权登录\n      </button>\n\n      <view class=\"tips\">\n        <text class=\"tips-text\">登录后即可使用所有功能</text>\n      </view>\n    </view>\n\n    <!-- 昵称设置弹窗 -->\n    <view v-if=\"showNicknamePopup\" class=\"popup-mask\" @click=\"closePopup\">\n      <view class=\"nickname-popup\" @click.stop>\n        <view class=\"popup-header\">\n          <text class=\"popup-title\">设置昵称</text>\n        </view>\n        <view class=\"popup-content\">\n          <text class=\"popup-desc\"\n            >请设置您的昵称，方便我们为您提供更好的服务</text\n          >\n          <input\n            class=\"nickname-input\"\n            v-model=\"nickname\"\n            placeholder=\"请输入昵称\"\n            maxlength=\"20\"\n            @input=\"onNicknameInput\"\n          />\n          <text class=\"input-tips\">昵称长度1-20个字符</text>\n        </view>\n        <view class=\"popup-footer\">\n          <button\n            class=\"confirm-btn\"\n            type=\"primary\"\n            @click=\"confirmNickname\"\n            :disabled=\"!nickname.trim()\"\n          >\n            确认\n          </button>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport Auth from \"../../utils/auth.js\";\n\nexport default {\n  name: \"Login\",\n  data() {\n    return {\n      isLoading: false,\n      nickname: \"\",\n      userInfo: null,\n      showNicknamePopup: false,\n      isAgreed: false, // 是否同意隐私协议\n    };\n  },\n  methods: {\n    // 切换隐私协议同意状态\n    toggleAgreement() {\n      this.isAgreed = !this.isAgreed;\n    },\n\n    // 跳转到隐私协议页面\n    goToPrivacy() {\n      uni.navigateTo({\n        url: \"/pages/privacy/privacy\",\n      });\n    },\n\n    // 获取手机号回调\n    getPhoneNumber(e) {\n      console.log(e);\n\n      // 检查是否同意隐私协议\n      if (!this.isAgreed) {\n        uni.showToast({\n          title: \"请先同意隐私协议\",\n          icon: \"none\",\n        });\n        return;\n      }\n\n      const phoneCode = e.detail.code;\n      this.handleWechatLogin(phoneCode);\n    },\n\n    // 微信授权登录\n    async handleWechatLogin(phoneCode) {\n      this.isLoading = true;\n\n      try {\n        // 获取用户信息\n        const userInfo = await Auth.wechatLogin(phoneCode);\n\n        if (userInfo) {\n          this.userInfo = userInfo;\n\n          // 检查是否有昵称\n          if (Auth.needSetNickname()) {\n            // 显示昵称设置弹窗\n            this.showNicknamePopup = true;\n          } else {\n            // 直接登录成功\n            this.loginSuccess(userInfo);\n          }\n        }\n      } catch (error) {\n        console.error(\"登录失败:\", error);\n        uni.showToast({\n          title: \"登录失败，请重试\",\n          icon: \"none\",\n        });\n      } finally {\n        this.isLoading = false;\n      }\n    },\n\n    // 昵称输入处理\n    onNicknameInput(e) {\n      this.nickname = e.detail.value;\n    },\n\n    // 关闭弹窗\n    closePopup() {\n      this.showNicknamePopup = false;\n    },\n\n    // 确认昵称设置\n    async confirmNickname() {\n      if (!this.nickname.trim()) {\n        uni.showToast({\n          title: \"请输入昵称\",\n          icon: \"none\",\n        });\n        return;\n      }\n\n      try {\n        // 更新用户信息\n        const updatedUserInfo = {\n          ...this.userInfo,\n          nickName: this.nickname.trim(),\n        };\n\n        // 保存用户信息\n        Auth.setUserInfo(updatedUserInfo);\n\n        // 关闭弹窗\n        this.showNicknamePopup = false;\n\n        // 登录成功\n        this.loginSuccess(updatedUserInfo);\n\n        uni.showToast({\n          title: \"昵称设置成功\",\n          icon: \"success\",\n        });\n      } catch (error) {\n        console.error(\"设置昵称失败:\", error);\n        uni.showToast({\n          title: \"设置失败，请重试\",\n          icon: \"none\",\n        });\n      }\n    },\n\n    // 登录成功处理\n    loginSuccess(userInfo) {\n      uni.showToast({\n        title: \"登录成功\",\n        icon: \"success\",\n      });\n\n      // 延迟跳转到首页\n      setTimeout(() => {\n        uni.reLaunch({ url: \"/pages/index/index\" });\n      }, 1500);\n    },\n  },\n\n  onLoad() {\n    // 检查是否已登录\n    if (Auth.isLoggedIn()) {\n      uni.reLaunch({\n        url: \"/pages/index/index\",\n      });\n    }\n  },\n};\n</script>\n\n<style scoped>\n.login-container {\n  min-height: 100vh;\n  background: linear-gradient(135deg, #a5834e 0%, #247b3f 100%);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 40rpx;\n  position: relative;\n}\n\n/* 添加装饰性背景元素 */\n.login-container::before {\n  content: \"\";\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: radial-gradient(\n      circle at 20% 20%,\n      rgba(165, 131, 78, 0.3) 0%,\n      transparent 50%\n    ),\n    radial-gradient(\n      circle at 80% 80%,\n      rgba(36, 123, 63, 0.3) 0%,\n      transparent 50%\n    );\n  pointer-events: none;\n}\n\n.header {\n  text-align: center;\n  margin-bottom: 100rpx;\n  position: relative;\n  z-index: 1;\n}\n\n.logo {\n  width: 140rpx;\n  height: 140rpx;\n  object-fit: cover;\n  border-radius: 20rpx;\n  margin-bottom: 40rpx;\n  border: 4rpx solid rgba(255, 255, 255, 0.3);\n  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.2);\n}\n\n.title {\n  font-size: 48rpx;\n  font-weight: 600;\n  color: #ffffff;\n  display: block;\n  margin-bottom: 20rpx;\n  text-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.3);\n}\n\n.subtitle {\n  font-size: 30rpx;\n  color: rgba(255, 255, 255, 0.9);\n  display: block;\n  font-weight: 400;\n}\n\n.content {\n  width: 100%;\n  max-width: 600rpx;\n  position: relative;\n  z-index: 1;\n}\n\n.login-btn {\n  width: 100%;\n  height: 96rpx;\n  border-radius: 48rpx;\n  background: rgba(255, 255, 255, 0.95);\n  border: none;\n  margin-bottom: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.15);\n  font-size: 32rpx;\n  font-weight: 600;\n  color: #247b3f;\n  transition: all 0.3s ease;\n}\n\n.login-btn:active {\n  transform: translateY(2rpx);\n  box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.2);\n}\n\n.login-btn.disabled {\n  background: rgba(204, 204, 204, 0.8) !important;\n  color: #999999 !important;\n  box-shadow: none !important;\n  transform: none !important;\n}\n\n.btn-text {\n  color: #a5834e;\n  font-size: 32rpx;\n  font-weight: 600;\n}\n\n/* 隐私协议勾选样式 */\n.agreement-section {\n  margin-bottom: 40rpx;\n}\n\n.checkbox-wrapper {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20rpx;\n}\n\n.checkbox {\n  width: 36rpx;\n  height: 36rpx;\n  border: 3rpx solid rgba(255, 255, 255, 0.8);\n  border-radius: 6rpx;\n  margin-right: 16rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  transition: all 0.3s ease;\n}\n\n.checkbox.checked {\n  background: rgba(255, 255, 255, 0.95);\n  border-color: rgba(255, 255, 255, 0.95);\n}\n\n.check-icon {\n  font-size: 20rpx;\n  color: #247b3f;\n  font-weight: 700;\n}\n\n.agreement-text {\n  font-size: 28rpx;\n  color: rgba(255, 255, 255, 0.9);\n  line-height: 1.4;\n}\n\n.agreement-link {\n  color: #ffffff;\n  text-decoration: underline;\n  font-weight: 500;\n  text-underline-offset: 4rpx;\n}\n\n.tips {\n  text-align: center;\n}\n\n.tips-text {\n  font-size: 26rpx;\n  color: rgba(255, 255, 255, 0.8);\n  font-weight: 400;\n}\n\n/* 弹窗遮罩层 */\n.popup-mask {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.6);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 999;\n  backdrop-filter: blur(4rpx);\n}\n\n/* 昵称设置弹窗样式 */\n.nickname-popup {\n  background: #ffffff;\n  border-radius: 24rpx;\n  width: 600rpx;\n  padding: 50rpx 40rpx;\n  margin: 40rpx;\n  box-shadow: 0 16rpx 48rpx rgba(0, 0, 0, 0.2);\n}\n\n.popup-header {\n  text-align: center;\n  margin-bottom: 40rpx;\n  position: relative;\n}\n\n.popup-header::after {\n  content: \"\";\n  position: absolute;\n  bottom: -20rpx;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 60rpx;\n  height: 4rpx;\n  background: linear-gradient(90deg, #a5834e, #247b3f);\n  border-radius: 2rpx;\n}\n\n.popup-title {\n  font-size: 38rpx;\n  font-weight: 600;\n  color: #333333;\n}\n\n.popup-content {\n  margin-bottom: 50rpx;\n}\n\n.popup-desc {\n  font-size: 28rpx;\n  color: #666666;\n  line-height: 1.6;\n  margin-bottom: 30rpx;\n  display: block;\n}\n\n.nickname-input {\n  width: 100%;\n  height: 88rpx;\n  border: 2rpx solid #e8e8e8;\n  border-radius: 12rpx;\n  padding: 0 24rpx;\n  font-size: 30rpx;\n  margin-bottom: 20rpx;\n  box-sizing: border-box;\n  transition: border-color 0.3s ease;\n}\n\n.nickname-input:focus {\n  border-color: #a5834e;\n  box-shadow: 0 0 0 4rpx rgba(165, 131, 78, 0.1);\n}\n\n.input-tips {\n  font-size: 24rpx;\n  color: #999999;\n  display: block;\n}\n\n.popup-footer {\n  text-align: center;\n}\n\n.confirm-btn {\n  width: 100%;\n  height: 88rpx;\n  border-radius: 44rpx;\n  font-size: 32rpx;\n  font-weight: 600;\n  background: linear-gradient(135deg, #a5834e 0%, #247b3f 100%);\n  color: #ffffff;\n  border: none;\n  box-shadow: 0 6rpx 20rpx rgba(165, 131, 78, 0.3);\n  transition: all 0.3s ease;\n}\n\n.confirm-btn:active {\n  transform: translateY(2rpx);\n  box-shadow: 0 3rpx 12rpx rgba(165, 131, 78, 0.4);\n}\n\n.confirm-btn[disabled] {\n  background: #cccccc !important;\n  color: #ffffff !important;\n  box-shadow: none !important;\n  transform: none !important;\n}\n</style>\n","import MiniProgramPage from '/Users/will/Documents/WillProject/Uni-App/bxjf-mini-program/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","uni","e","phoneCode","userInfo","Auth","error","updatedUserInfo","MiniProgramPage"],"mappings":"4HA4EKA,EAAU,CACb,KAAM,QACN,MAAO,CACL,MAAO,CACL,UAAW,GACX,SAAU,GACV,SAAU,KACV,kBAAmB,GACnB,SAAU,GAEb,EACD,QAAS,CAEP,iBAAkB,CAChB,KAAK,SAAW,CAAC,KAAK,QACvB,EAGD,aAAc,CACZC,EAAAA,MAAI,WAAW,CACb,IAAK,wBACP,CAAC,CACF,EAGD,eAAeC,EAAG,CAIhB,GAHAD,EAAAA,MAAY,MAAA,MAAA,+BAAAC,CAAC,EAGT,CAAC,KAAK,SAAU,CAClBD,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACR,CAAC,EACD,MACF,CAEA,MAAME,EAAYD,EAAE,OAAO,KAC3B,KAAK,kBAAkBC,CAAS,CACjC,EAGD,MAAM,kBAAkBA,EAAW,CACjC,KAAK,UAAY,GAEjB,GAAI,CAEF,MAAMC,EAAW,MAAMC,EAAAA,KAAK,YAAYF,CAAS,EAE7CC,IACF,KAAK,SAAWA,EAGZC,EAAAA,KAAK,kBAEP,KAAK,kBAAoB,GAGzB,KAAK,aAAaD,CAAQ,EAG9B,OAAOE,EAAO,CACdL,EAAc,MAAA,MAAA,QAAA,+BAAA,QAASK,CAAK,EAC5BL,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACR,CAAC,CACH,QAAU,CACR,KAAK,UAAY,EACnB,CACD,EAGD,gBAAgBC,EAAG,CACjB,KAAK,SAAWA,EAAE,OAAO,KAC1B,EAGD,YAAa,CACX,KAAK,kBAAoB,EAC1B,EAGD,MAAM,iBAAkB,CACtB,GAAI,CAAC,KAAK,SAAS,OAAQ,CACzBD,EAAAA,MAAI,UAAU,CACZ,MAAO,QACP,KAAM,MACR,CAAC,EACD,MACF,CAEA,GAAI,CAEF,MAAMM,EAAkB,CACtB,GAAG,KAAK,SACR,SAAU,KAAK,SAAS,KAAM,GAIhCF,OAAK,YAAYE,CAAe,EAGhC,KAAK,kBAAoB,GAGzB,KAAK,aAAaA,CAAe,EAEjCN,EAAAA,MAAI,UAAU,CACZ,MAAO,SACP,KAAM,SACR,CAAC,CACD,OAAOK,EAAO,CACdL,EAAA,MAAA,MAAA,QAAA,+BAAc,UAAWK,CAAK,EAC9BL,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACR,CAAC,CACH,CACD,EAGD,aAAaG,EAAU,CACrBH,EAAAA,MAAI,UAAU,CACZ,MAAO,OACP,KAAM,SACR,CAAC,EAGD,WAAW,IAAM,CACfA,EAAAA,MAAI,SAAS,CAAE,IAAK,oBAAsB,CAAA,CAC3C,EAAE,IAAI,CACR,CACF,EAED,QAAS,CAEHI,EAAAA,KAAK,cACPJ,EAAAA,MAAI,SAAS,CACX,IAAK,oBACP,CAAC,CAEJ,CACH,upBC1NA,GAAG,WAAWO,CAAe"}