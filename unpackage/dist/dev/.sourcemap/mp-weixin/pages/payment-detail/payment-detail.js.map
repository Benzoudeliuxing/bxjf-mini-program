{"version":3,"file":"payment-detail.js","sources":["pages/payment-detail/payment-detail.vue","pages/payment-detail/payment-detail.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"payment-detail-container\">\n    <!-- 加载状态 -->\n    <view v-if=\"loading\" class=\"loading\">\n      <text>加载中...</text>\n    </view>\n\n    <!-- 订单详情内容 -->\n    <view v-else-if=\"orderDetail\">\n      <!-- 支付状态卡片 -->\n      <view class=\"status-card\">\n        <view\n          class=\"status-icon\"\n          :class=\"getStatusClass(orderDetail.payStatus)\"\n        >\n          <text v-if=\"orderDetail.payStatus === 2\">✓</text>\n          <text v-else-if=\"orderDetail.payStatus === 1\">⏳</text>\n          <text v-else-if=\"orderDetail.payStatus === 3\">🔄</text>\n          <text v-else-if=\"orderDetail.payStatus === 4\">↩</text>\n          <text v-else>✗</text>\n        </view>\n        <text class=\"status-text\">{{\n          getStatusText(orderDetail.payStatus)\n        }}</text>\n        <text class=\"amount\">¥{{ orderDetail.payPrice }}</text>\n      </view>\n\n      <!-- 投保人信息 -->\n      <view class=\"info-section\">\n        <view class=\"section-title\">投保人信息</view>\n        <view class=\"info-list\">\n          <view class=\"info-item\">\n            <text class=\"label\">姓名</text>\n            <text class=\"value\">{{ orderDetail.tbName || \"-\" }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">身份证号</text>\n            <text class=\"value\">{{ formatIdCard(orderDetail.tbIdCard) }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">手机号</text>\n            <text class=\"value\">{{ orderDetail.tbPhone || \"-\" }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">住址</text>\n            <text class=\"value\">{{ orderDetail.tbAddress || \"-\" }}</text>\n          </view>\n        </view>\n      </view>\n\n      <!-- 被保人信息 -->\n      <view class=\"info-section\">\n        <view class=\"section-title\">被保人信息</view>\n        <view class=\"info-list\">\n          <view class=\"info-item\">\n            <text class=\"label\">姓名</text>\n            <text class=\"value\">{{ orderDetail.bbName || \"-\" }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">身份证号</text>\n            <text class=\"value\">{{ formatIdCard(orderDetail.bbIdCard) }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">手机号</text>\n            <text class=\"value\">{{ orderDetail.bbPhone || \"-\" }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">住址</text>\n            <text class=\"value\">{{ orderDetail.bbAddress || \"-\" }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">学校</text>\n            <text class=\"value\">{{ orderDetail.bbSchool || \"-\" }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">班级</text>\n            <text class=\"value\">{{ orderDetail.bbClass || \"-\" }}</text>\n          </view>\n        </view>\n      </view>\n\n      <!-- 支付信息 -->\n      <view class=\"info-section\">\n        <view class=\"section-title\">支付信息</view>\n        <view class=\"info-list\">\n          <view class=\"info-item\">\n            <text class=\"label\">支付金额</text>\n            <text class=\"value amount-text\">¥{{ orderDetail.payPrice }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">支付时间</text>\n            <text class=\"value\">{{ formatDate(orderDetail.payTime) }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"label\">支付状态</text>\n            <text\n              class=\"value\"\n              :class=\"getStatusClass(orderDetail.payStatus)\"\n              >{{ getStatusText(orderDetail.payStatus) }}</text\n            >\n          </view>\n        </view>\n      </view>\n\n      <!-- 操作按钮 - 只有待支付时显示 -->\n      <view class=\"action-section\" v-if=\"orderDetail.payStatus === 1\">\n        <button class=\"pay-btn\" @click=\"goToPay\">支付订单</button>\n        <button class=\"delete-btn\" @click=\"deleteOrder\">删除订单</button>\n      </view>\n    </view>\n\n    <!-- 错误状态 -->\n    <view v-else class=\"error-state\">\n      <text>订单信息加载失败</text>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { formatAmount } from \"@/utils/payment.js\";\nimport { businessApi } from \"@/utils/api.js\";\n\nexport default {\n  name: \"PaymentDetail\",\n  data() {\n    return {\n      orderId: null,\n      orderDetail: null,\n      loading: true,\n    };\n  },\n  methods: {\n    formatAmount,\n\n    goBack() {\n      uni.navigateBack();\n    },\n\n    getStatusText(status) {\n      const statusMap = {\n        1: \"待支付\",\n        2: \"已支付\",\n        3: \"申请退款\",\n        4: \"已退款\",\n      };\n      return statusMap[status] || \"未知状态\";\n    },\n\n    getStatusClass(status) {\n      const classMap = {\n        1: \"unpaid\",\n        2: \"paid\",\n        3: \"refunding\",\n        4: \"refunded\",\n      };\n      return classMap[status] || \"unknown\";\n    },\n\n    formatDate(dateString) {\n      if (!dateString) return \"待支付\";\n      const date = new Date(dateString);\n      return date.toLocaleString(\"zh-CN\", {\n        year: \"numeric\",\n        month: \"2-digit\",\n        day: \"2-digit\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        second: \"2-digit\",\n      });\n    },\n\n    formatIdCard(idCard) {\n      if (!idCard) return \"-\";\n      // 身份证号脱敏处理\n      if (idCard.length >= 10) {\n        return (\n          idCard.substring(0, 6) + \"****\" + idCard.substring(idCard.length - 4)\n        );\n      }\n      return idCard;\n    },\n\n    goToPay() {\n      // 构建支付页面参数\n      const paymentParams = {\n        id: this.orderId,\n      };\n\n      // 跳转到支付页面\n      const queryString = Object.keys(paymentParams)\n        .map((key) => `${key}=${encodeURIComponent(paymentParams[key])}`)\n        .join(\"&\");\n      uni.redirectTo({\n        url: `/pages/payment/payment?${queryString}`,\n      });\n    },\n\n    async deleteOrder() {\n      try {\n        const result = await uni.showModal({\n          title: \"确认删除\",\n          content: \"确定要删除这个订单吗？\",\n          confirmText: \"删除\",\n          cancelText: \"取消\",\n        });\n\n        if (result.confirm) {\n          uni.showLoading({ title: \"删除中...\" });\n\n          await businessApi.deleteOrder(this.orderId);\n\n          uni.hideLoading();\n          uni.showToast({\n            title: \"删除成功\",\n            icon: \"success\",\n          });\n\n          // 延迟返回上一页\n          setTimeout(() => {\n            uni.navigateBack();\n          }, 1500);\n        }\n      } catch (error) {\n        console.error(\"删除订单失败:\", error);\n        uni.hideLoading();\n        uni.showToast({\n          title: \"删除失败，请重试\",\n          icon: \"none\",\n        });\n      }\n    },\n\n    async loadOrderDetail() {\n      if (!this.orderId) {\n        uni.showToast({\n          title: \"订单ID不能为空\",\n          icon: \"none\",\n        });\n        return;\n      }\n\n      try {\n        this.loading = true;\n        const response = await businessApi.getOrderDetail({ id: this.orderId });\n\n        if (response && response.data) {\n          this.orderDetail = response.data;\n        } else {\n          throw new Error(\"获取订单详情失败\");\n        }\n      } catch (error) {\n        console.error(\"加载订单详情失败:\", error);\n        uni.showToast({\n          title: \"加载失败，请重试\",\n          icon: \"none\",\n        });\n      } finally {\n        this.loading = false;\n      }\n    },\n  },\n\n  onLoad(options) {\n    // 接收页面参数\n    if (options.id) {\n      this.orderId = parseInt(options.id);\n      // 加载订单详情\n      this.loadOrderDetail();\n    } else {\n      uni.showToast({\n        title: \"订单ID不能为空\",\n        icon: \"none\",\n      });\n      this.loading = false;\n    }\n  },\n\n  // 页面显示时刷新数据\n  onShow() {\n    if (this.orderId) {\n      this.loadOrderDetail();\n    }\n  },\n};\n</script>\n\n<style scoped>\n.payment-detail-container {\n  padding: 20rpx;\n  background-color: #f5f5f5;\n  min-height: 100vh;\n}\n\n.header {\n  display: flex;\n  align-items: center;\n  padding: 20rpx 0;\n  margin-bottom: 20rpx;\n}\n\n.back-btn {\n  width: 80rpx;\n  height: 80rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: #fff;\n  border-radius: 50%;\n  margin-right: 20rpx;\n}\n\n.back-icon {\n  font-size: 36rpx;\n  color: #333;\n}\n\n.title {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n}\n\n.loading {\n  text-align: center;\n  padding: 100rpx 0;\n  color: #999;\n}\n\n.error-state {\n  text-align: center;\n  padding: 100rpx 0;\n  color: #999;\n}\n\n.status-card {\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 60rpx 40rpx;\n  text-align: center;\n  margin-bottom: 20rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n}\n\n.status-icon {\n  width: 120rpx;\n  height: 120rpx;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 auto 20rpx;\n  font-size: 60rpx;\n  color: #fff;\n}\n\n.status-icon.paid {\n  background-color: #52c41a;\n}\n\n.status-icon.unpaid {\n  background-color: #e09801;\n}\n\n.status-icon.refunding {\n  background-color: #2b8dbc;\n}\n\n.status-icon.refunded {\n  background-color: #722ed1;\n}\n\n.status-icon.unknown {\n  background-color: #d9d9d9;\n}\n\n.status-text {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 20rpx;\n  display: block;\n}\n\n.amount {\n  font-size: 48rpx;\n  font-weight: bold;\n  color: #ff6b35;\n}\n\n.info-section {\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 40rpx;\n  margin-bottom: 20rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n}\n\n.section-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 30rpx;\n}\n\n.info-list {\n  display: flex;\n  flex-direction: column;\n  gap: 20rpx;\n}\n\n.info-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20rpx 0;\n  border-bottom: 2rpx solid #f0f0f0;\n}\n\n.info-item:last-child {\n  border-bottom: none;\n}\n\n.label {\n  color: #666;\n  font-size: 28rpx;\n  min-width: 120rpx;\n}\n\n.value {\n  color: #333;\n  font-size: 28rpx;\n  text-align: right;\n  max-width: 60%;\n  word-break: break-all;\n}\n\n.amount-text {\n  color: #ff6b35;\n  font-weight: bold;\n}\n\n.value.paid {\n  color: #52c41a;\n}\n\n.value.unpaid {\n  color: #e09801;\n}\n\n.value.refunding {\n  color: #2b8dbc;\n}\n\n.value.refunded {\n  color: #722ed1;\n}\n\n.action-section {\n  padding: 40rpx 0;\n  display: flex;\n  flex-direction: column;\n  gap: 20rpx;\n}\n\n.pay-btn {\n  width: 100%;\n  height: 100rpx;\n  background-color: #2b8dbc;\n  color: #fff;\n  border-radius: 50rpx;\n  font-size: 32rpx;\n  font-weight: bold;\n  border: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.pay-btn:active {\n  background-color: #2b8dbc;\n}\n\n.delete-btn {\n  width: 100%;\n  height: 100rpx;\n  background-color: #c51d34;\n  color: #fff;\n  border-radius: 50rpx;\n  font-size: 32rpx;\n  font-weight: bold;\n  border: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.delete-btn:active {\n  background-color: #c51d34;\n}\n</style>\n","import MiniProgramPage from '/Users/will/Documents/WillProject/Uni-App/bxjf-mini-program/pages/payment-detail/payment-detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["_sfc_main","formatAmount","uni","status","dateString","idCard","paymentParams","queryString","key","businessApi","error","response","options","MiniProgramPage"],"mappings":"2HA0HKA,EAAU,CACb,KAAM,gBACN,MAAO,CACL,MAAO,CACL,QAAS,KACT,YAAa,KACb,QAAS,GAEZ,EACD,QAAS,cACPC,EAAY,aAEZ,QAAS,CACPC,EAAG,MAAC,aAAY,CACjB,EAED,cAAcC,EAAQ,CAOpB,MANkB,CAChB,EAAG,MACH,EAAG,MACH,EAAG,OACH,EAAG,OAEYA,CAAM,GAAK,MAC7B,EAED,eAAeA,EAAQ,CAOrB,MANiB,CACf,EAAG,SACH,EAAG,OACH,EAAG,YACH,EAAG,YAEWA,CAAM,GAAK,SAC5B,EAED,WAAWC,EAAY,CACrB,OAAKA,EACQ,IAAI,KAAKA,CAAU,EACpB,eAAe,QAAS,CAClC,KAAM,UACN,MAAO,UACP,IAAK,UACL,KAAM,UACN,OAAQ,UACR,OAAQ,SACV,CAAC,EATuB,KAUzB,EAED,aAAaC,EAAQ,CACnB,OAAKA,EAEDA,EAAO,QAAU,GAEjBA,EAAO,UAAU,EAAG,CAAC,EAAI,OAASA,EAAO,UAAUA,EAAO,OAAS,CAAC,EAGjEA,EAPa,GAQrB,EAED,SAAU,CAER,MAAMC,EAAgB,CACpB,GAAI,KAAK,SAILC,EAAc,OAAO,KAAKD,CAAa,EAC1C,IAAKE,GAAQ,GAAGA,CAAG,IAAI,mBAAmBF,EAAcE,CAAG,CAAC,CAAC,EAAE,EAC/D,KAAK,GAAG,EACXN,EAAAA,MAAI,WAAW,CACb,IAAK,0BAA0BK,CAAW,EAC5C,CAAC,CACF,EAED,MAAM,aAAc,CAClB,GAAI,EACa,MAAML,EAAG,MAAC,UAAU,CACjC,MAAO,OACP,QAAS,cACT,YAAa,KACb,WAAY,IACd,CAAC,GAEU,UACTA,EAAAA,MAAI,YAAY,CAAE,MAAO,QAAU,CAAA,EAEnC,MAAMO,cAAY,YAAY,KAAK,OAAO,EAE1CP,EAAG,MAAC,YAAW,EACfA,EAAAA,MAAI,UAAU,CACZ,MAAO,OACP,KAAM,SACR,CAAC,EAGD,WAAW,IAAM,CACfA,EAAG,MAAC,aAAY,CACjB,EAAE,IAAI,EAET,OAAOQ,EAAO,CACdR,EAAA,MAAA,MAAA,QAAA,iDAAc,UAAWQ,CAAK,EAC9BR,EAAG,MAAC,YAAW,EACfA,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACR,CAAC,CACH,CACD,EAED,MAAM,iBAAkB,CACtB,GAAI,CAAC,KAAK,QAAS,CACjBA,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACR,CAAC,EACD,MACF,CAEA,GAAI,CACF,KAAK,QAAU,GACf,MAAMS,EAAW,MAAMF,EAAAA,YAAY,eAAe,CAAE,GAAI,KAAK,OAAM,CAAG,EAEtE,GAAIE,GAAYA,EAAS,KACvB,KAAK,YAAcA,EAAS,SAE5B,OAAM,IAAI,MAAM,UAAU,CAE5B,OAAOD,EAAO,CACdR,EAAc,MAAA,MAAA,QAAA,iDAAA,YAAaQ,CAAK,EAChCR,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACR,CAAC,CACH,QAAU,CACR,KAAK,QAAU,EACjB,CACD,CACF,EAED,OAAOU,EAAS,CAEVA,EAAQ,IACV,KAAK,QAAU,SAASA,EAAQ,EAAE,EAElC,KAAK,gBAAe,IAEpBV,EAAAA,MAAI,UAAU,CACZ,MAAO,WACP,KAAM,MACR,CAAC,EACD,KAAK,QAAU,GAElB,EAGD,QAAS,CACH,KAAK,SACP,KAAK,gBAAe,CAEvB,CACH,+tCC1RA,GAAG,WAAWW,CAAe"}