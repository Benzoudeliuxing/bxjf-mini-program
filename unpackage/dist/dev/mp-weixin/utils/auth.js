"use strict";const e=require("../common/vendor.js"),a=require("./api.js");class S{static isLoggedIn(){return e.index.getStorageSync("isLoggedIn")===!0}static getUserInfo(){return e.index.getStorageSync("userInfo")||null}static setUserInfo(t){e.index.setStorageSync("userInfo",t),e.index.setStorageSync("isLoggedIn",!0)}static clearUserInfo(){e.index.removeStorageSync("userInfo"),e.index.removeStorageSync("isLoggedIn"),e.index.removeStorageSync("token"),e.index.removeStorageSync("openid")}static getToken(){return e.index.getStorageSync("token")||null}static setToken(t){e.index.setStorageSync("token",t)}static clearToken(){e.index.removeStorageSync("token")}static getOpenid(){return e.index.getStorageSync("openid")||null}static setOpenid(t){e.index.setStorageSync("openid",t)}static clearOpenid(){e.index.removeStorageSync("openid")}static getNickname(){const t=this.getUserInfo();return t?t.nickname:""}static needSetNickname(){const t=this.getUserInfo();return!t||!t.nickname||t.nickname==="微信用户"}static async wechatLogin(t){return new Promise((c,s)=>{e.index.login({provider:"weixin",success:n=>{e.index.__f__("log","at utils/auth.js:104","微信授权成功:",n);const r=n.code,d={phoneCode:t,loginCode:r,state:"9b2ffbc1-7425-4155-9894-9d5c08541d62"};a.api.wechat.wechatLogin(d).then(o=>{if(e.index.__f__("log","at utils/auth.js:112","微信登录结果:",o),o.code==0){const g=o.data.accessToken,u=o.data.openid;this.setToken(g),this.setOpenid(u),a.api.user.getProfile().then(i=>{i.code==0&&(this.setUserInfo(i.data),c(i.data))})}else s(o)})},fail:n=>{e.index.__f__("error","at utils/auth.js:131","微信授权失败:",n),s(n)}})})}static logout(){this.clearUserInfo(),e.index.showToast({title:"已退出登录",icon:"success"}),setTimeout(()=>{e.index.reLaunch({url:"/pages/login/login"})},1500)}}exports.Auth=S;
//# sourceMappingURL=../../.sourcemap/mp-weixin/utils/auth.js.map
