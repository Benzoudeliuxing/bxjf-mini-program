"use strict";const a=require("../common/vendor.js"),n=require("./api.js");async function c(e){try{const t={...e,orderId:parseInt(e.orderId)};return(await n.api.payment.createPayment(t)).data}catch(t){throw new Error(t.message||"获取支付参数失败")}}function u(e){return new Promise((t,r)=>{a.index.requestPayment({provider:"wxpay",timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:s=>{t({success:!0,data:s})},fail:s=>{t({success:!1,error:s})}})})}async function i(e){try{return(await n.paymentApi.verifyPayment({orderId:parseInt(e.orderId)})).data}catch(t){throw new Error(t.message||"验证支付结果失败")}}async function o(e){try{const t=await c(e),r=await u(t);return r.success?{success:!0,data:await i(e)}:{success:!1,error:r.error}}catch(t){return{success:!1,error:t.message}}}function y(e){return(e/100).toFixed(2)}function f(e){if(typeof e=="string")return e;if(e.errMsg){if(e.errMsg.includes("cancel"))return"支付已取消";if(e.errMsg.includes("fail"))return"支付失败，请重试";if(e.errMsg.includes("timeout"))return"支付超时，请重试"}return"支付失败，请重试"}exports.formatAmount=y;exports.getErrorMessage=f;exports.wechatPay=o;
//# sourceMappingURL=../../.sourcemap/mp-weixin/utils/payment.js.map
