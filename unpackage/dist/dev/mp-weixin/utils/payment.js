"use strict";const n=require("../common/vendor.js");function s(e){return new Promise((r,a)=>{n.index.request({url:"YOUR_API_BASE_URL/api/payment/wechat/create",method:"POST",data:{orderId:e.orderId,amount:e.amount,description:e.description||"商品购买"},header:{"Content-Type":"application/json",Authorization:"Bearer "+n.index.getStorageSync("token")},success:t=>{t.statusCode===200&&t.data.success?r(t.data.data):a(new Error(t.data.message||"获取支付参数失败"))},fail:t=>{a(new Error("网络请求失败"))}})})}function i(e){return new Promise((r,a)=>{n.index.requestPayment({provider:"wxpay",timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:t=>{r({success:!0,data:t})},fail:t=>{r({success:!1,error:t})}})})}function c(e){return new Promise((r,a)=>{n.index.request({url:"YOUR_API_BASE_URL/api/payment/verify",method:"POST",data:{orderId:e.orderId},header:{"Content-Type":"application/json",Authorization:"Bearer "+n.index.getStorageSync("token")},success:t=>{t.statusCode===200&&t.data.success?r(t.data.data):a(new Error(t.data.message||"验证支付结果失败"))},fail:t=>{a(new Error("网络请求失败"))}})})}async function u(e){try{const r=await s(e),a=await i(r);return a.success?{success:!0,data:await c(e)}:{success:!1,error:a.error}}catch(r){return{success:!1,error:r.message}}}function o(e){return(e/100).toFixed(2)}function d(e){if(typeof e=="string")return e;if(e.errMsg){if(e.errMsg.includes("cancel"))return"支付已取消";if(e.errMsg.includes("fail"))return"支付失败，请重试";if(e.errMsg.includes("timeout"))return"支付超时，请重试"}return"支付失败，请重试"}exports.formatAmount=o;exports.getErrorMessage=d;exports.wechatPay=u;
//# sourceMappingURL=../../.sourcemap/mp-weixin/utils/payment.js.map
