"use strict";const e=require("../../common/vendor.js"),n=require("../../utils/payment.js"),d=require("../../utils/api.js"),u={name:"PaymentRecord",data(){return{searchKeyword:"",currentStatus:"",records:[],loading:!1,pageNo:1,pageSize:10,hasMore:!0}},computed:{filteredRecords(){let t=this.records;if(this.searchKeyword){const s=this.searchKeyword.toLowerCase();t=t.filter(r=>r.title&&r.title.toLowerCase().includes(s)||r.orderNo&&r.orderNo.toLowerCase().includes(s)||r.description&&r.description.toLowerCase().includes(s))}return t}},methods:{formatAmount:n.formatAmount,onSearchInput(){},async filterByStatus(t){this.currentStatus=t,this.pageNo=1,this.records=[],this.hasMore=!0,await this.loadPaymentRecords()},getStatusText(t){return{1:"待支付",2:"已支付",3:"申请退款",4:"已退款"}[t]||"未知状态"},getStatusClass(t){return{1:"unpaid",2:"paid",3:"refunding",4:"refunded"}[t]||""},formatDate(t){return t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"待缴费"},goToDetail(t){e.index.navigateTo({url:`/pages/payment-detail/payment-detail?id=${t.id}&orderNo=${t.orderNo||t.orderNumber}`})},async loadPaymentRecords(){if(!(this.loading||!this.hasMore)){this.loading=!0;try{const t={pageNo:this.pageNo,pageSize:this.pageSize};this.currentStatus&&(t.payStatus=this.currentStatus);const s=await d.businessApi.getOrderList(t);if(s&&s.data){const r=s.data.list||s.data||[];this.pageNo===1?this.records=r:this.records=[...this.records,...r],this.hasMore=r.length===this.pageSize,this.hasMore&&this.pageNo++}}catch(t){e.index.__f__("error","at pages/payment-record/payment-record.vue:203","获取订单列表失败:",t),e.index.showToast({title:"获取数据失败",icon:"none"})}finally{this.loading=!1}}},async loadMore(){!this.loading&&this.hasMore&&await this.loadPaymentRecords()}},async onLoad(){await this.loadPaymentRecords()},async onShow(){this.pageNo=1,this.records=[],this.hasMore=!0,await this.loadPaymentRecords()},onReachBottom(){this.loadMore()}};function c(t,s,r,l,o,i){return e.e({a:o.currentStatus===""?1:"",b:e.o(a=>i.filterByStatus("")),c:o.currentStatus==="1"?1:"",d:e.o(a=>i.filterByStatus("1")),e:o.currentStatus==="2"?1:"",f:e.o(a=>i.filterByStatus("2")),g:e.f(i.filteredRecords,(a,g,f)=>({a:e.t(a.title||a.name||"保险订单"),b:e.t(i.getStatusText(a.payStatus)),c:e.n(i.getStatusClass(a.payStatus)),d:e.t(a.payPrice),e:e.t(a.payTime||"-"),f:e.t(a.orderNo||"-"),g:a.id,h:e.o(p=>i.goToDetail(a),a.id)})),h:i.filteredRecords.length===0},i.filteredRecords.length===0?{}:{})}const h=e._export_sfc(u,[["render",c],["__scopeId","data-v-e44f00af"]]);wx.createPage(h);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/payment-record/payment-record.js.map
