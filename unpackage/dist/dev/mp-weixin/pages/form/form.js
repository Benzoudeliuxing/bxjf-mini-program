"use strict";const e=require("../../common/vendor.js"),d=require("../../utils/request.js"),b=require("../../utils/auth.js"),m={name:"Form",data(){return{isSubmitting:!1,formData:{tbName:"",tbIdCard:"",tbPhone:"",tbAddress:"",bbName:"",bbIdCard:"",bbPhone:"",bbAddress:"",bbSchool:"",bbClass:"",payPrice:"1",openid:""}}},onLoad(){const r=b.Auth.getOpenid();r&&(this.formData.openid=r)},methods:{validateIdCard(r){return/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(r)},validatePhone(r){return/^1[3-9]\d{9}$/.test(r)},validateRequired(r,a){return!r||r.trim()===""?(e.index.showToast({title:`请填写${a}`,icon:"none"}),!1):!0},async submitForm(){if(!this.isSubmitting&&this.validateRequired(this.formData.tbName,"投保人姓名")&&this.validateRequired(this.formData.tbIdCard,"投保人身份证号")){if(!this.validateIdCard(this.formData.tbIdCard)){e.index.showToast({title:"投保人身份证号格式不正确",icon:"none"});return}if(this.validateRequired(this.formData.tbPhone,"投保人联系电话")){if(!this.validatePhone(this.formData.tbPhone)){e.index.showToast({title:"投保人手机号格式不正确",icon:"none"});return}if(this.validateRequired(this.formData.tbAddress,"投保人住址")&&this.validateRequired(this.formData.bbName,"被保险人姓名")&&this.validateRequired(this.formData.bbIdCard,"被保险人身份证号")){if(!this.validateIdCard(this.formData.bbIdCard)){e.index.showToast({title:"被保险人身份证号格式不正确",icon:"none"});return}if(this.validateRequired(this.formData.bbPhone,"被保险人联系电话")){if(!this.validatePhone(this.formData.bbPhone)){e.index.showToast({title:"被保险人手机号格式不正确",icon:"none"});return}this.validateRequired(this.formData.bbAddress,"被保险人住址")&&this.validateRequired(this.formData.bbSchool,"学校")&&this.validateRequired(this.formData.bbClass,"班级")&&await this.submitToServer()}}}}},quickFill(){const r=this.formData.openid;this.formData={tbName:"张三",tbIdCard:"110101199001011234",tbPhone:"13800138000",tbAddress:"北京市朝阳区朝阳路123号",bbName:"李四",bbIdCard:"110101200501012345",bbPhone:"13900139000",bbAddress:"北京市朝阳区朝阳路456号",bbSchool:"北京市第一中学",bbClass:"高三(1)班",payPrice:"1",openid:r},e.index.showToast({title:"测试数据填写完成",icon:"success",duration:1500})},async submitToServer(){this.isSubmitting=!0;try{e.index.showLoading({title:"提交中...",mask:!0});const r=await d.request.post("/app-api/bxgm/order/create",this.formData);e.index.__f__("log","at pages/form/form.vue:294","提交成功:",r),e.index.hideLoading(),e.index.showToast({title:"信息提交成功",icon:"success",duration:1500}),setTimeout(()=>{const a={id:r.data},n=Object.keys(a).map(s=>`${s}=${encodeURIComponent(a[s])}`).join("&");e.index.redirectTo({url:`/pages/payment/payment?${n}`})},1500)}catch(r){e.index.__f__("error","at pages/form/form.vue:320","提交失败:",r),e.index.hideLoading();let a="提交失败，请重试";r.message?a=r.message:r.errMsg&&(a=r.errMsg),e.index.showToast({title:a,icon:"none",duration:3e3})}finally{this.isSubmitting=!1}}}};function u(r,a,n,s,i,o){return{a:i.formData.tbName,b:e.o(t=>i.formData.tbName=t.detail.value),c:i.formData.tbIdCard,d:e.o(t=>i.formData.tbIdCard=t.detail.value),e:i.formData.tbPhone,f:e.o(t=>i.formData.tbPhone=t.detail.value),g:i.formData.tbAddress,h:e.o(t=>i.formData.tbAddress=t.detail.value),i:i.formData.bbName,j:e.o(t=>i.formData.bbName=t.detail.value),k:i.formData.bbIdCard,l:e.o(t=>i.formData.bbIdCard=t.detail.value),m:i.formData.bbPhone,n:e.o(t=>i.formData.bbPhone=t.detail.value),o:i.formData.bbAddress,p:e.o(t=>i.formData.bbAddress=t.detail.value),q:i.formData.bbSchool,r:e.o(t=>i.formData.bbSchool=t.detail.value),s:i.formData.bbClass,t:e.o(t=>i.formData.bbClass=t.detail.value),v:e.o((...t)=>o.quickFill&&o.quickFill(...t)),w:e.t(i.isSubmitting?"提交中...":"提交信息"),x:e.o((...t)=>o.submitForm&&o.submitForm(...t)),y:i.isSubmitting}}const f=e._export_sfc(m,[["render",u],["__scopeId","data-v-f6c40170"]]);wx.createPage(f);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/form/form.js.map
