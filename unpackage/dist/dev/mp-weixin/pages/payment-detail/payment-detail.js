"use strict";const e=require("../../common/vendor.js"),d=require("../../utils/payment.js"),s=require("../../utils/api.js"),l={name:"PaymentDetail",data(){return{orderId:null,orderDetail:null,loading:!0}},methods:{formatAmount:d.formatAmount,goBack(){e.index.navigateBack()},getStatusText(r){return{1:"待支付",2:"已支付",3:"申请退款",4:"已退款"}[r]||"未知状态"},getStatusClass(r){return{1:"unpaid",2:"paid",3:"refunding",4:"refunded"}[r]||"unknown"},formatDate(r){return r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"待支付"},formatIdCard(r){return r?r.length>=10?r.substring(0,6)+"****"+r.substring(r.length-4):r:"-"},goToPay(){const r={id:this.orderId},a=Object.keys(r).map(o=>`${o}=${encodeURIComponent(r[o])}`).join("&");e.index.redirectTo({url:`/pages/payment/payment?${a}`})},async deleteOrder(){try{(await e.index.showModal({title:"确认删除",content:"确定要删除这个订单吗？",confirmText:"删除",cancelText:"取消"})).confirm&&(e.index.showLoading({title:"删除中..."}),await s.businessApi.deleteOrder(this.orderId),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"success"}),setTimeout(()=>{e.index.navigateBack()},1500))}catch(r){e.index.__f__("error","at pages/payment-detail/payment-detail.vue:224","删除订单失败:",r),e.index.hideLoading(),e.index.showToast({title:"删除失败，请重试",icon:"none"})}},async loadOrderDetail(){if(!this.orderId){e.index.showToast({title:"订单ID不能为空",icon:"none"});return}try{this.loading=!0;const r=await s.businessApi.getOrderDetail({id:this.orderId});if(r&&r.data)this.orderDetail=r.data;else throw new Error("获取订单详情失败")}catch(r){e.index.__f__("error","at pages/payment-detail/payment-detail.vue:252","加载订单详情失败:",r),e.index.showToast({title:"加载失败，请重试",icon:"none"})}finally{this.loading=!1}}},onLoad(r){r.id?(this.orderId=parseInt(r.id),this.loadOrderDetail()):(e.index.showToast({title:"订单ID不能为空",icon:"none"}),this.loading=!1)},onShow(){this.orderId&&this.loadOrderDetail()}};function u(r,a,o,D,t,i){return e.e({a:t.loading},t.loading?{}:t.orderDetail?e.e({c:t.orderDetail.payStatus===2},t.orderDetail.payStatus===2?{}:t.orderDetail.payStatus===1?{}:t.orderDetail.payStatus===3?{}:t.orderDetail.payStatus===4?{}:{},{d:t.orderDetail.payStatus===1,e:t.orderDetail.payStatus===3,f:t.orderDetail.payStatus===4,g:e.n(i.getStatusClass(t.orderDetail.payStatus)),h:e.t(i.getStatusText(t.orderDetail.payStatus)),i:e.t(t.orderDetail.payPrice),j:e.t(t.orderDetail.tbName||"-"),k:e.t(i.formatIdCard(t.orderDetail.tbIdCard)),l:e.t(t.orderDetail.tbPhone||"-"),m:e.t(t.orderDetail.tbAddress||"-"),n:e.t(t.orderDetail.bbName||"-"),o:e.t(i.formatIdCard(t.orderDetail.bbIdCard)),p:e.t(t.orderDetail.bbPhone||"-"),q:e.t(t.orderDetail.bbAddress||"-"),r:e.t(t.orderDetail.bbSchool||"-"),s:e.t(t.orderDetail.bbClass||"-"),t:e.t(t.orderDetail.payPrice),v:e.t(i.formatDate(t.orderDetail.payTime)),w:e.t(i.getStatusText(t.orderDetail.payStatus)),x:e.n(i.getStatusClass(t.orderDetail.payStatus)),y:t.orderDetail.payStatus===1},t.orderDetail.payStatus===1?{z:e.o((...n)=>i.goToPay&&i.goToPay(...n)),A:e.o((...n)=>i.deleteOrder&&i.deleteOrder(...n))}:{}):{},{b:t.orderDetail})}const c=e._export_sfc(l,[["render",u],["__scopeId","data-v-f76f7b53"]]);wx.createPage(c);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/payment-detail/payment-detail.js.map
