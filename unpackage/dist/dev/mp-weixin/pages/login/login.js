"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/auth.js"),r=require("../../common/assets.js"),a={name:"Login",data(){return{isLoading:!1,nickname:"",userInfo:null,showNicknamePopup:!1,isAgreed:!1}},methods:{toggleAgreement(){this.isAgreed=!this.isAgreed},goToPrivacy(){e.index.navigateTo({url:"/pages/privacy/privacy"})},getPhoneNumber(n){if(e.index.__f__("log","at pages/login/login.vue:103",n),!this.isAgreed){e.index.showToast({title:"请先同意隐私协议",icon:"none"});return}const c=n.detail.code;this.handleWechatLogin(c)},async handleWechatLogin(n){this.isLoading=!0;try{const c=await t.Auth.wechatLogin(n);c&&(this.userInfo=c,t.Auth.needSetNickname()?this.showNicknamePopup=!0:this.loginSuccess(c))}catch(c){e.index.__f__("error","at pages/login/login.vue:139","登录失败:",c),e.index.showToast({title:"登录失败，请重试",icon:"none"})}finally{this.isLoading=!1}},onNicknameInput(n){this.nickname=n.detail.value},closePopup(){this.showNicknamePopup=!1},async confirmNickname(){if(!this.nickname.trim()){e.index.showToast({title:"请输入昵称",icon:"none"});return}try{const n={...this.userInfo,nickName:this.nickname.trim()};t.Auth.setUserInfo(n),this.showNicknamePopup=!1,this.loginSuccess(n),e.index.showToast({title:"昵称设置成功",icon:"success"})}catch(n){e.index.__f__("error","at pages/login/login.vue:190","设置昵称失败:",n),e.index.showToast({title:"设置失败，请重试",icon:"none"})}},loginSuccess(n){e.index.showToast({title:"登录成功",icon:"success"}),setTimeout(()=>{e.index.reLaunch({url:"/pages/index/index"})},1500)}},onLoad(){t.Auth.isLoggedIn()&&e.index.reLaunch({url:"/pages/index/index"})}};function u(n,c,h,l,s,o){return e.e({a:r._imports_0,b:s.isAgreed},s.isAgreed?{}:{},{c:s.isAgreed?1:"",d:e.o((...i)=>o.goToPrivacy&&o.goToPrivacy(...i)),e:e.o((...i)=>o.toggleAgreement&&o.toggleAgreement(...i)),f:s.isAgreed?"":1,g:e.o((...i)=>o.getPhoneNumber&&o.getPhoneNumber(...i)),h:!s.isAgreed,i:s.showNicknamePopup},s.showNicknamePopup?{j:e.o([i=>s.nickname=i.detail.value,(...i)=>o.onNicknameInput&&o.onNicknameInput(...i)]),k:s.nickname,l:e.o((...i)=>o.confirmNickname&&o.confirmNickname(...i)),m:!s.nickname.trim(),n:e.o(()=>{}),o:e.o((...i)=>o.closePopup&&o.closePopup(...i))}:{})}const g=e._export_sfc(a,[["render",u],["__scopeId","data-v-e4e4508d"]]);wx.createPage(g);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/login.js.map
