"use strict";const e=require("../../common/vendor.js"),c=require("../../utils/auth.js"),a=require("../../common/assets.js"),r={name:"Login",data(){return{isLoading:!1,nickname:"",userInfo:null,showNicknamePopup:!1}},methods:{getPhoneNumber(n){e.index.__f__("log","at pages/login/login.vue:73",n);const o=n.detail.code;this.handleWechatLogin(o)},async handleWechatLogin(n){this.isLoading=!0;try{const o=await c.Auth.wechatLogin(n);o&&(this.userInfo=o,c.Auth.needSetNickname()?this.showNicknamePopup=!0:this.loginSuccess(o))}catch(o){e.index.__f__("error","at pages/login/login.vue:99","登录失败:",o),e.index.showToast({title:"登录失败，请重试",icon:"none"})}finally{this.isLoading=!1}},onNicknameInput(n){this.nickname=n.detail.value},closePopup(){this.showNicknamePopup=!1},async confirmNickname(){if(!this.nickname.trim()){e.index.showToast({title:"请输入昵称",icon:"none"});return}try{const n={...this.userInfo,nickName:this.nickname.trim()};c.Auth.setUserInfo(n),this.showNicknamePopup=!1,this.loginSuccess(n),e.index.showToast({title:"昵称设置成功",icon:"success"})}catch(n){e.index.__f__("error","at pages/login/login.vue:150","设置昵称失败:",n),e.index.showToast({title:"设置失败，请重试",icon:"none"})}},loginSuccess(n){e.index.showToast({title:"登录成功",icon:"success"}),setTimeout(()=>{e.index.reLaunch({url:"/pages/index/index"})},1500)}},onLoad(){c.Auth.isLoggedIn()&&e.index.reLaunch({url:"/pages/index/index"})}};function u(n,o,m,l,t,s){return e.e({a:a._imports_0,b:e.o((...i)=>s.getPhoneNumber&&s.getPhoneNumber(...i)),c:t.showNicknamePopup},t.showNicknamePopup?{d:e.o([i=>t.nickname=i.detail.value,(...i)=>s.onNicknameInput&&s.onNicknameInput(...i)]),e:t.nickname,f:e.o((...i)=>s.confirmNickname&&s.confirmNickname(...i)),g:!t.nickname.trim(),h:e.o(()=>{}),i:e.o((...i)=>s.closePopup&&s.closePopup(...i))}:{})}const h=e._export_sfc(r,[["render",u],["__scopeId","data-v-e4e4508d"]]);wx.createPage(h);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/login.js.map
