"use strict";const r=require("../../common/vendor.js"),a=require("../../utils/payment.js"),i=require("../../utils/api.js"),u=require("../../common/assets.js"),c={name:"Payment",data(){return{orderId:0,orderInfo:{orderId:0,orderNo:"",productName:"",amount:0,payPrice:0,payStatus:1,tbName:"",tbIdCard:"",tbPhone:"",tbAddress:"",bbName:"",bbIdCard:"",bbPhone:"",bbAddress:"",bbSchool:"",bbClass:""},selectedMethod:"wechat",isPaying:!1}},onLoad(t){this.getOrderInfo(t)},methods:{getOrderInfo(t){r.index.__f__("log","at pages/payment/payment.vue:190","支付页面接收到的参数:",t),this.orderId=parseInt(t.id),i.api.business.getOrderDetail({id:this.orderId}).then(o=>{r.index.__f__("log","at pages/payment/payment.vue:196","订单信息:",o),o.code==0&&(this.orderInfo=o.data)})},getStatusText(t){return{1:"待支付",2:"已支付",3:"申请退款",4:"已退款"}[t]||"待支付"},getStatusClass(t){return{1:"status-pending",2:"status-paid",3:"status-refunding",4:"status-refunded"}[t]||"status-pending"},formatIdCard(t){return!t||t.length<10?t:t.substring(0,6)+"****"+t.substring(t.length-4)},selectPaymentMethod(t){this.selectedMethod=t},async handlePayment(){if(!this.isPaying){if(!this.orderId||this.orderId<=0){r.index.showToast({title:"订单信息错误",icon:"none"});return}this.isPaying=!0;try{const t=parseInt(this.orderId),o=await a.wechatPay({orderId:t});o.success?this.paymentSuccess():this.paymentFail(o.error)}catch(t){this.paymentFail(t)}finally{this.isPaying=!1}}},paymentSuccess(){r.index.showToast({title:"支付成功",icon:"success"}),setTimeout(()=>{const t={orderId:this.orderInfo.orderId,orderNo:this.orderInfo.orderNo,amount:this.orderInfo.payPrice,productName:this.orderInfo.productName},o=Object.keys(t).map(n=>`${n}=${encodeURIComponent(t[n])}`).join("&");r.index.redirectTo({url:`/pages/payment-success/payment-success?${o}`})},1500)},paymentFail(t){const o=a.getErrorMessage(t);r.index.showToast({title:o,icon:"none"})}}};function I(t,o,n,p,e,s){return r.e({a:r.t(s.getStatusText(e.orderInfo.payStatus)),b:r.n(s.getStatusClass(e.orderInfo.payStatus)),c:r.t(e.orderInfo.orderNo),d:r.t(e.orderInfo.productName),e:r.t((e.orderInfo.amount/100).toFixed(2)),f:r.t((e.orderInfo.payPrice/100).toFixed(2)),g:r.t(e.orderInfo.tbName),h:r.t(s.formatIdCard(e.orderInfo.tbIdCard)),i:r.t(e.orderInfo.tbPhone),j:r.t(e.orderInfo.tbAddress),k:r.t(e.orderInfo.bbName),l:r.t(s.formatIdCard(e.orderInfo.bbIdCard)),m:r.t(e.orderInfo.bbPhone),n:r.t(e.orderInfo.bbAddress),o:r.t(e.orderInfo.bbSchool),p:r.t(e.orderInfo.bbClass),q:e.orderInfo.payStatus===1},e.orderInfo.payStatus===1?{r:u._imports_0$1,s:e.selectedMethod==="wechat"?1:"",t:r.o(d=>s.selectPaymentMethod("wechat"))}:{},{v:e.orderInfo.payStatus===1||e.orderInfo.payStatus==null},e.orderInfo.payStatus===1||e.orderInfo.payStatus==null?{w:r.t(e.isPaying?"支付中...":"立即支付"),x:r.o((...d)=>s.handlePayment&&s.handlePayment(...d)),y:e.isPaying}:{},{z:e.orderInfo.payStatus===2},e.orderInfo.payStatus===2?{}:{},{A:e.orderInfo.payStatus===3||e.orderInfo.payStatus===4},e.orderInfo.payStatus===3||e.orderInfo.payStatus===4?{B:r.t(e.orderInfo.payStatus===3?"申请退款中":"已完成退款")}:{},{C:e.orderInfo.payStatus===1},e.orderInfo.payStatus===1?{}:{})}const f=r._export_sfc(c,[["render",I],["__scopeId","data-v-eade9ab2"]]);wx.createPage(f);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/payment/payment.js.map
