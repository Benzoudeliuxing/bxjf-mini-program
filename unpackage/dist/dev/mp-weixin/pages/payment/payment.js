"use strict";const t=require("../../common/vendor.js"),d=require("../../utils/payment.js"),i=require("../../utils/api.js"),c=require("../../common/assets.js"),u={name:"Payment",data(){return{orderId:0,orderInfo:{orderId:0,orderNo:"",productName:"",amount:0,payPrice:0,payStatus:1,tbName:"",tbIdCard:"",tbPhone:"",tbAddress:"",bbName:"",bbIdCard:"",bbPhone:"",bbAddress:"",bbSchool:"",bbClass:""},selectedMethod:"wechat",isPaying:!1}},onLoad(r){this.getOrderInfo(r)},methods:{getOrderInfo(r){t.index.__f__("log","at pages/payment/payment.vue:186","支付页面接收到的参数:",r),this.orderId=parseInt(r.id),i.api.business.getOrderDetail({id:this.orderId}).then(s=>{t.index.__f__("log","at pages/payment/payment.vue:192","订单信息:",s),s.code==0&&(this.orderInfo=s.data)})},getStatusText(r){return{1:"待支付",2:"已支付",3:"申请退款",4:"已退款"}[r]||"待支付"},getStatusClass(r){return{1:"status-pending",2:"status-paid",3:"status-refunding",4:"status-refunded"}[r]||"status-pending"},formatIdCard(r){return!r||r.length<10?r:r.substring(0,6)+"****"+r.substring(r.length-4)},selectPaymentMethod(r){this.selectedMethod=r},async handlePayment(){if(!this.isPaying){if(!this.orderId||this.orderId<=0){t.index.showToast({title:"订单信息错误",icon:"none"});return}this.isPaying=!0;try{const r=parseInt(this.orderId),s=await d.wechatPay({orderId:r});s.success?this.paymentSuccess():this.paymentFail(s.error)}catch(r){this.paymentFail(r)}finally{this.isPaying=!1}}},paymentSuccess(){t.index.showToast({title:"支付成功",icon:"success"}),setTimeout(()=>{const r={orderId:this.orderInfo.orderId,orderNo:this.orderInfo.orderNo,amount:this.orderInfo.payPrice,productName:this.orderInfo.productName},s=Object.keys(r).map(n=>`${n}=${encodeURIComponent(r[n])}`).join("&");t.index.redirectTo({url:`/pages/payment-success/payment-success?${s}`})},1500)},paymentFail(r){const s=d.getErrorMessage(r);t.index.showToast({title:s,icon:"none"})}}};function I(r,s,n,p,e,o){return t.e({a:t.t(o.getStatusText(e.orderInfo.payStatus)),b:t.n(o.getStatusClass(e.orderInfo.payStatus)),c:t.t(e.orderInfo.orderNo)},{},{},{},{e:t.t(e.orderInfo.payPrice),f:t.t(e.orderInfo.payPrice),g:t.t(e.orderInfo.tbName),h:t.t(o.formatIdCard(e.orderInfo.tbIdCard)),i:t.t(e.orderInfo.tbPhone),j:t.t(e.orderInfo.tbAddress),k:t.t(e.orderInfo.bbName),l:t.t(o.formatIdCard(e.orderInfo.bbIdCard)),m:t.t(e.orderInfo.bbPhone),n:t.t(e.orderInfo.bbAddress),o:t.t(e.orderInfo.bbSchool),p:t.t(e.orderInfo.bbClass),q:e.orderInfo.payStatus===1},e.orderInfo.payStatus===1?{r:c._imports_0$1,s:e.selectedMethod==="wechat"?1:"",t:t.o(a=>o.selectPaymentMethod("wechat"))}:{},{v:e.orderInfo.payStatus===1||e.orderInfo.payStatus==null},e.orderInfo.payStatus===1||e.orderInfo.payStatus==null?{w:t.t(e.isPaying?"支付中...":"立即支付"),x:t.o((...a)=>o.handlePayment&&o.handlePayment(...a)),y:e.isPaying}:{},{z:e.orderInfo.payStatus===2},e.orderInfo.payStatus===2?{}:{},{A:e.orderInfo.payStatus===3||e.orderInfo.payStatus===4},e.orderInfo.payStatus===3||e.orderInfo.payStatus===4?{B:t.t(e.orderInfo.payStatus===3?"申请退款中":"已完成退款")}:{},{})}const f=t._export_sfc(u,[["render",I],["__scopeId","data-v-eade9ab2"]]);wx.createPage(f);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/payment/payment.js.map
